<!doctype html>
<html lang="vi"><head><meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Đăng nhập quản trị</title>
<style>
body{font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#0b1324;color:#e5e7eb;margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center}
.card{background:#111827;border:1px solid #1f2937;border-radius:16px;padding:22px;width:min(92vw,380px);box-shadow:0 10px 30px rgba(0,0,0,.45)}
h1{margin:0 0 12px;color:#93c5fd;font-size:20px}
input{width:100%;padding:12px;border-radius:12px;border:1px solid #263144;background:#0b1324;color:#e5e7eb}
input+input{margin-top:12px}
button{width:100%;margin-top:14px;padding:12px;border-radius:12px;border:0;background:#2563eb;color:#fff;font-weight:600}
p#msg{min-height:18px;margin:10px 0 0;color:#fca5a5}
.small{opacity:.7;font-size:12px;margin-top:10px}
</style></head>
<body>
  <div class="card">
    <h1>Đăng nhập quản trị</h1>
    <input id="u" autocomplete="username" placeholder="Tài khoản"/>
    <input id="p" type="password" autocomplete="current-password" placeholder="Mật khẩu"/>
    <button id="go" type="button">Đăng nhập</button>
    <p id="msg"></p>
    <div class="small">Sau khi đăng nhập thành công, bạn sẽ được chuyển vào trang Admin.</div>
  </div>
<script>
(function(){
  const API_BASE = window.API_BASE || '/api';
  const q = (s)=>document.querySelector(s);
  async function login(u,p){
    const url = API_BASE.replace(/\/$/,'') + '/admin/login?u='+encodeURIComponent(u)+'&p='+encodeURIComponent(p);
    const r = await fetch(url, {method:'GET'});
    if(!r.ok) throw new Error('HTTP '+r.status);
    const j = await r.json();
    if(!j || !j.token) throw new Error('Thiếu token');
    localStorage.setItem('admin_token', j.token);
    const go = new URL('/admin', location.origin);
    go.searchParams.set('token', j.token);
    location.href = go.toString();
  }
  q('#go').addEventListener('click', async ()=>{
    q('#msg').textContent='';
    try{ await login(q('#u').value.trim(), q('#p').value.trim()); }
    catch(e){ console.error(e); q('#msg').textContent='Đăng nhập thất bại'; }
  });
  ['u','p'].forEach(id=>q('#'+id).addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); q('#go').click(); } }));
  // nếu đã có token thì vào thẳng admin
  try{
    const t = localStorage.getItem('admin_token') || new URL(location.href).searchParams.get('token');
    if(t){ const go = new URL('/admin', location.origin); go.searchParams.set('token', t); location.replace(go.toString()); }
  }catch(_){}
})();
</script>
</body></html>