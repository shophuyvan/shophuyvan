<!doctype html><html lang="vi"><head><meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Đăng nhập Admin</title>
<style>body{margin:0;background:#0f172a;color:#e2e8f0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
main{max-width:420px;margin:60px auto;padding:0 16px}.card{background:#0b1222;border:1px solid #1f2a44;border-radius:12px;padding:18px}
input,button{width:100%;padding:10px;border-radius:8px;border:1px solid #334155;background:#111827;color:#e2e8f0;margin-top:10px}
button{background:#2563eb;border-color:#2563eb}</style></head><body><main>
<div class="card"><h2>Đăng nhập quản trị</h2>
<input id="u" placeholder="Tài khoản" value="admin" autocomplete="username"/><input id="p" placeholder="Mật khẩu" type="password" autocomplete="current-password"/>
<button id="btn">Đăng nhập</button><p id="msg"></p>
<p style="font-size:12px;color:#94a3b8">Nếu 404, hệ thống sẽ tự thử các endpoint dự phòng.</p>
</div>
<script type="module">
const API='/api';
const tryList = [
  { method:'GET',  path:(u,p)=>`/admin/login?u=${encodeURIComponent(u)}&p=${encodeURIComponent(p)}` },
  { method:'GET',  path:(u,p)=>`/login?u=${encodeURIComponent(u)}&p=${encodeURIComponent(p)}` },
  { method:'GET',  path:(u,p)=>`/admin_login?u=${encodeURIComponent(u)}&p=${encodeURIComponent(p)}` },
  { method:'POST', path:()=>`/admin/login`,    body:(u,p)=>JSON.stringify({u,p}), headers:{'content-type':'application/json'} },
  { method:'POST', path:()=>`/login`,          body:(u,p)=>JSON.stringify({u,p}), headers:{'content-type':'application/json'} },
];
async function attempt(u, p){
  for await (const opt of tryList){
    const url = API + opt.path(u,p);
    try{
      const res = await fetch(url, {
        method: opt.method,
        mode:'cors', credentials:'omit', cache:'no-store',
        headers: opt.headers || {},
        body: opt.method==='POST' ? (opt.body?opt.body(u,p):undefined) : undefined
      });
      if (res.status === 404) { msg.textContent = 'Đang thử endpoint khác...'; continue; }
      if (res.status === 401 || res.status === 403) { msg.textContent = 'Sai tài khoản hoặc mật khẩu'; return null; }
      const ct = res.headers.get('content-type') || '';
      let token = '';
      if (ct.includes('application/json')) {
        const j = await res.json().catch(()=>null);
        token = (j && (j.token || j.t || j.id)) ? (j.token || j.t || j.id) : '';
      } else {
        token = (await res.text()).trim();
      }
      if (res.ok && token && token.length > 8) return token;
      if (token && token.length > 8) return token;
    }catch(e){
      console.warn('Login attempt failed on', url, e);
      continue;
    }
  }
  return null;
}
btn.onclick = async () => {
  msg.textContent = 'Đang đăng nhập...';
  const user = u.value.trim();
  const pass = p.value;
  const token = await attempt(user, pass);
  if (token){
    location.href = '/admin/?token=' + encodeURIComponent(token);
  } else {
    msg.textContent = 'Đăng nhập thất bại (404/không khớp). Kiểm tra endpoint login trong Worker.';
  }
};
</script></main></body></html>