export async function api(path, init={}){const base=(document.querySelector('#api-base')?.value||'https://shv-api.shophuyvan.workers.dev').replace(/\/$/,'');const url=base+(path.startsWith('/')?path:'/'+path);const headers=new Headers(init.headers||{});if(!(init.body instanceof FormData)&&init.body&&typeof init.body==='object'){headers.set('Content-Type','application/json');init={...init,body:JSON.stringify(init.body)}}const res=await fetch(url,{...init,headers});if(!res.ok)throw new Error('HTTP '+res.status+' at '+url);const ct=res.headers.get('content-type')||'';return ct.includes('application/json')?res.json():res.text()}