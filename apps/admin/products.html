<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sản phẩm • Shop Huy Vân</title>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    /* Shopee-style floating header */
    .shv-pdp-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: linear-gradient(180deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.2) 50%, transparent 100%);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .shv-icon-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(8px);
      border: none;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .shv-icon-btn:hover {
      background: rgba(0,0,0,0.6);
    }
    
    .shv-cart-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      min-width: 18px;
      height: 18px;
      background: #ef4444;
      color: white;
      font-size: 10px;
      font-weight: bold;
      border-radius: 9px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 4px;
      animation: bounce 0.5s;
    }
    
    /* Bottom action bar */
    .shv-bottom-bar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 100;
      background: white;
      border-top: 1px solid #e5e7eb;
      padding: 10px 16px calc(env(safe-area-inset-bottom, 0px) + 10px);
      box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
    }
    
    .shv-bottom-bar .actions {
      display: flex;
      gap: 10px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .shv-btn-chat {
      flex: 0 0 auto;
      min-width: 80px;
      padding: 10px 16px;
      border: 2px solid #0068FF;
      color: #0068FF;
      background: white;
      border-radius: 12px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .shv-btn-chat:hover {
      background: #f0f8ff;
    }
    
    .shv-btn-add {
      flex: 1;
      padding: 10px 16px;
      border: 2px solid #ef4444;
      color: #ef4444;
      background: #fff5f5;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .shv-btn-add:hover {
      background: #ffe5e5;
    }
    
    .shv-btn-buy {
      flex: 1;
      padding: 10px 16px;
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
      transition: all 0.2s;
    }
    
    .shv-btn-buy:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
    }
    
    /* Share dropdown */
    .shv-share-menu {
      position: absolute;
      top: 50px;
      right: 0;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      overflow: hidden;
      min-width: 180px;
      display: none;
    }
    
    .shv-share-menu.show {
      display: block;
      animation: slideDown 0.2s ease-out;
    }
    
    .shv-share-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      cursor: pointer;
      transition: background 0.2s;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .shv-share-item:last-child {
      border-bottom: none;
    }
    
    .shv-share-item:hover {
      background: #f9fafb;
    }
    
    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.2); }
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* Hide default header */
    body.pdp header, 
    body.pdp .topbar, 
    body.pdp .site-header {
      display: none !important;
    }
    
    /* Responsive */
    @media (max-width: 640px) {
      .shv-btn-chat span {
        display: none;
      }
      
      .shv-btn-add, .shv-btn-buy {
        font-size: 13px;
        padding: 10px 12px;
      }
    }
  </style>
</head>
<body class="bg-slate-50 text-gray-900 pdp">
  <!-- Shopee-style Header -->
  <div class="shv-pdp-header">
    <button id="btn-back" class="shv-icon-btn" aria-label="Quay lại">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
        <path fill-rule="evenodd" d="M15.75 19.5a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 1 1 1.06 1.06L9.06 11.25l6.69 6.69a.75.75 0 0 1 0 1.06z" clip-rule="evenodd" />
      </svg>
    </button>
    
    <div style="display: flex; gap: 8px; align-items: center;">
      <div style="position: relative;">
        <button id="btn-share" class="shv-icon-btn" aria-label="Chia sẻ">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
            <path fill-rule="evenodd" d="M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z" clip-rule="evenodd" />
          </svg>
        </button>
        
        <div id="share-menu" class="shv-share-menu">
          <div class="shv-share-item" data-type="zalo">
            <div style="width: 32px; height: 32px; background: #0068FF; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px;">Z</div>
            <span style="font-weight: 600; font-size: 14px;">Chia sẻ Zalo</span>
          </div>
          <div class="shv-share-item" data-type="facebook">
            <div style="width: 32px; height: 32px; background: #1877F2; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px;">f</div>
            <span style="font-weight: 600; font-size: 14px;">Chia sẻ Facebook</span>
          </div>
        </div>
      </div>
      
      <a href="/cart.html" id="btn-cart" class="shv-icon-btn" style="position: relative;" aria-label="Giỏ hàng">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
          <path d="M2.25 2.25a.75.75 0 0 0 0 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 0 0-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 0 0 0-1.5H5.378A2.25 2.25 0 0 1 7.5 15h11.218a.75.75 0 0 0 .674-.421 60.358 60.358 0 0 0 2.96-7.228.75.75 0 0 0-.525-.965A60.864 60.864 0 0 0 5.68 4.509l-.232-.867A1.875 1.875 0 0 0 3.636 2.25H2.25ZM3.75 20.25a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 20.25a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" />
        </svg>
        <span id="cart-badge" class="shv-cart-badge" style="display: none;">0</span>
      </a>
    </div>
  </div>

  <main class="max-w-6xl mx-auto px-4 py-6 pb-32" style="padding-top: 60px;">
    <section class="md:col-span-6 space-y-2">
      <div id="media-main" class="relative aspect-square bg-white rounded-lg overflow-hidden"></div>
    </section>
    
    <section class="md:col-span-6 space-y-4 mt-4">
      <h1 id="p-title" class="text-xl md:text-2xl font-semibold"></h1>
      <div class="flex items-center gap-3 text-sm text-gray-600">
        <span id="p-sold">0 đã bán</span><span>•</span><span id="p-rating">5★</span>
      </div>
      <div id="p-price" class="text-2xl font-semibold"></div>
      <div id="p-stock" class="text-sm text-gray-500"></div>
    </section>
    
    <section class="mt-6">
      <h2 class="font-semibold mb-2">Mô tả</h2>
      <article id="p-desc" class="prose prose-sm max-w-none"></article>
    </section>
  </main>

  <!-- Bottom Action Bar -->
  <div class="shv-bottom-bar">
    <div class="actions">
      <button id="btn-chat-zalo" class="shv-btn-chat">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
          <path d="M4.913 2.658c2.075-.27 4.19-.408 6.337-.408 2.147 0 4.262.139 6.337.408 1.922.25 3.291 1.861 3.405 3.727a4.403 4.403 0 00-1.032-.211 50.89 50.89 0 00-8.42 0c-2.358.196-4.04 2.19-4.04 4.434v4.286a4.47 4.47 0 002.433 3.984L7.28 21.53A.75.75 0 016 21v-4.03a48.527 48.527 0 01-1.087-.128C2.905 16.58 1.5 14.833 1.5 12.862V6.638c0-1.97 1.405-3.718 3.413-3.979z" />
          <path d="M15.75 7.5c-1.376 0-2.739.057-4.086.169C10.124 7.797 9 9.103 9 10.609v4.285c0 1.507 1.128 2.814 2.67 2.94 1.243.102 2.5.157 3.768.165l2.782 2.781a.75.75 0 001.28-.53v-2.39l.33-.026c1.542-.125 2.67-1.433 2.67-2.94v-4.286c0-1.505-1.125-2.811-2.664-2.94A49.392 49.392 0 0015.75 7.5z" />
        </svg>
        <span>Chat</span>
      </button>
      
      <button id="btn-add-cart" class="shv-btn-add">
        Thêm vào giỏ
      </button>
      
      <button id="btn-buy-now" class="shv-btn-buy">
        MUA NGAY
      </button>
    </div>
  </div>

  <script type="module" src="/src/ui-pdp.js?v=72"></script>
  
  <script>
    // Cart badge realtime update
    function updateCartBadge() {
      try {
        const raw = localStorage.getItem('cart') || localStorage.getItem('shv_cart_v1');
        if (!raw) {
          document.getElementById('cart-badge').style.display = 'none';
          return;
        }
        
        const data = JSON.parse(raw);
        let count = 0;
        
        if (Array.isArray(data)) {
          count = data.reduce((s, item) => s + (Number(item.qty) || 1), 0);
        } else if (data?.lines && Array.isArray(data.lines)) {
          count = data.lines.reduce((s, item) => s + (Number(item.qty) || 1), 0);
        }
        
        const badge = document.getElementById('cart-badge');
        if (count > 0) {
          badge.textContent = count > 99 ? '99+' : count;
          badge.style.display = 'flex';
        } else {
          badge.style.display = 'none';
        }
      } catch (e) {
        console.error('[CartBadge] Error:', e);
      }
    }
    
    // Update on load
    updateCartBadge();
    
    // Listen to storage events
    window.addEventListener('storage', updateCartBadge);
    window.addEventListener('shv:cart-changed', updateCartBadge);
    
    // Poll every 2s
    setInterval(updateCartBadge, 2000);
    
    // Header buttons
    document.getElementById('btn-back').onclick = () => {
      try { history.back(); } catch { location.href = '/'; }
    };
    
    // Share menu
    const shareBtn = document.getElementById('btn-share');
    const shareMenu = document.getElementById('share-menu');
    
    shareBtn.onclick = (e) => {
      e.stopPropagation();
      shareMenu.classList.toggle('show');
    };
    
    document.addEventListener('click', () => {
      shareMenu.classList.remove('show');
    });
    
    document.querySelectorAll('.shv-share-item').forEach(item => {
      item.onclick = () => {
        const type = item.dataset.type;
        const url = encodeURIComponent(location.href);
        const title = encodeURIComponent(document.title);
        
        if (type === 'zalo') {
          window.open(`https://zalo.me/share?url=${url}&title=${title}`, '_blank');
        } else if (type === 'facebook') {
          window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
        }
        
        shareMenu.classList.remove('show');
      };
    });
    
    // Bottom bar actions (will be handled by ui-pdp.js)
    document.getElementById('btn-chat-zalo').onclick = () => {
      window.open('https://zalo.me/', '_blank');
    };
  </script>
</body>
</html>