<!doctype html><html lang="vi"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Banners</title><link rel="stylesheet" href="./styles.css"/><script src="./admin_real.js?v=25"></script><!-- build:21 -->
</head>
<body><div class="container">
  <div class="header">
    <div class="title">Banner</div>
    <div class="nav">
      <a href="./products.html" class="badge">Sản phẩm</a>
      <a href="./banners.html" class="badge">Banner</a>
      <a href="./vouchers.html" class="badge">Voucher</a><a href="./orders.html" class="badge">Đơn hàng</a><a href="./stats.html" class="badge">Thống kê</a><a href="./shipping.html" class="badge">Vận chuyển</a><a href="./ads.html" class="badge">Quảng cáo</a>
      <span class="badge">API: <span data-api-base></span></span>
    </div>
  </div>

  <div class="card">
    <div class="row">
      <div class="col"><label>Ảnh (URL)</label><input id="img" class="input" placeholder="https://..."/></div>
      <div><label>&nbsp;</label><input id="file" type="file" accept="image/*"/></div>
      <div><label>&nbsp;</label><button class="btn" id="up">Upload</button></div>
    </div>
    <div class="row">
      <div class="col"><label>Vị trí</label>
      <label>Thứ tự</label><input id="order" class="input" type="number" value="0"/>
      <label>ALT</label><input id="alt" class="input" placeholder="Mô tả ảnh"/>
      <label>Liên kết</label><input id="link" class="input" placeholder="https://..."/><input id="pos" class="input" placeholder="home"/></div>
      <div class="col"><label>Trạng thái</label><select id="on" class="input"><option value="true">ON</option><option value="false">OFF</option></select></div>
      <div><label>&nbsp;</label><button class="btn primary" id="save">Lưu</button></div>
    </div>
  </div>

  <h3>Danh sách</h3>
  <table class="table"><thead><tr><th>Ảnh</th><th>Vị trí</th><th>ON</th></tr></thead><tbody id="list"></tbody></table>
</div>
<script>
const $ = s=>document.querySelector(s);
async function doUpload(f){
  const fd = new FormData(); fd.append('file', f);
  let r = await Admin.req('/admin/upload', { method:'POST', body:fd });
  if(!(r && r.ok)) r = await Admin.req('/admin/files', { method:'POST', body:fd });
  return (r && r.ok && r.urls && r.urls[0]) ? r.urls[0] : '';
}
$('#up').onclick = async ()=>{
  const f = $('#file').files[0]; if(!f) return alert('Chọn ảnh');
  const url = await doUpload(f); if(url) $('#img').value = url;
};
$('#save').onclick = async ()=>{
  const body = { image: $('#img').value.trim(), pos: $('#pos').value.trim()||'home', on: $('#on').value==='true' };
  let r = await Admin.req('/admin/banners/upsert', { method:'POST', body });
  if(!(r && r.ok)) r = await Admin.req('/admin/banner', { method:'POST', body });
  if(r && r.ok){ load(); Admin.toast('Đã lưu'); } else alert('Lưu thất bại');
};
async function load(){
  const r = await Admin.tryPaths(['/banners','/admin/banners/list','/admin/banners']);
  const items = r.items || r.banners || r.data || [];
  const tb = $('#list'); tb.innerHTML='';
  items.forEach(b=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td><img class="thumb" src="${b.image||b.url||''}" alt="${b.alt||''}"/></td>
<td>${b.pos||'home'}</td>
<td>${(b.on===undefined?true:b.on)?'ON':'OFF'}</td>
<td>${b.order||0}</td>
<td>${b.alt||''}</td>
<td><a href="${b.link||'#'}" target="_blank">${b.link||''}</a></td>
<td><button class="btn danger" data-del="${b.id}">Xoá</button></td>`;
    tb.appendChild(tr);
  });
}
load();

const tb = document.getElementById('list');
tb.onclick = async (e)=>{
  const id = e.target && e.target.dataset && e.target.dataset.del;
  if(!id) return;
  if(!confirm('Xác nhận xoá banner này?')) return;
  let r = await Admin.req('/admin/banners/delete', {method:'POST', body:{id}});
  if(!(r && r.ok)) r = await Admin.req('/admin/banner/delete', {method:'POST', body:{id}});
  if(r && r.ok){ load(); Admin.toast('Đã xoá'); } else alert('Xoá thất bại');
};
</script>
</body></html>
