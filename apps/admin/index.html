<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin - Shop Huy Vân</title>
  <link rel="stylesheet" href="./styles.css"/>
  <style>
    /* Sidebar Layout */
    body {
      margin: 0;
      display: flex;
      min-height: 100vh;
      background: #f8fafc;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: #fff;
      border-right: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      position: fixed;
      left: 0;
      top: 0;
      bottom: 0;
      overflow-y: auto;
      transition: transform 0.3s ease;
      z-index: 100;
    }

    .sidebar.collapsed {
      transform: translateX(-100%);
    }

    /* Logo */
    .sidebar-logo {
      padding: 20px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .sidebar-logo img {
      width: 32px;
      height: 32px;
      border-radius: 8px;
    }

    .sidebar-logo-text {
      font-weight: 700;
      font-size: 16px;
      color: #0f172a;
    }

    /* Menu */
    .sidebar-menu {
      padding: 12px 0;
      flex: 1;
    }

    .menu-section {
      margin-bottom: 24px;
    }

    .menu-section-title {
      padding: 8px 20px;
      font-size: 11px;
      font-weight: 600;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 20px;
      color: #475569;
      text-decoration: none;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }

    .menu-item:hover {
      background: #f1f5f9;
      color: #0f172a;
      text-decoration: none;
    }

    .menu-item.active {
      background: #eff6ff;
      color: #2563eb;
      border-left-color: #2563eb;
      font-weight: 600;
    }

    .menu-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
    }

    /* Main Content */
    .main-content {
      margin-left: 260px;
      flex: 1;
      display: flex;
      flex-direction: column;
      transition: margin-left 0.3s ease;
    }

    .main-content.expanded {
      margin-left: 0;
    }

    /* Top Bar */
    .topbar {
      background: #fff;
      border-bottom: 1px solid #e5e7eb;
      padding: 12px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .menu-toggle {
      display: none;
      background: none;
      border: none;
      padding: 8px;
      cursor: pointer;
      color: #64748b;
    }

    .topbar-title {
      font-size: 20px;
      font-weight: 700;
      color: #0f172a;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .topbar-user {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      background: #f8fafc;
      border-radius: 8px;
      cursor: pointer;
    }

    .topbar-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 600;
      font-size: 14px;
    }

    /* Content Area */
    .content-area {
      padding: 24px;
      flex: 1;
    }

    /* Mobile */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .menu-toggle {
        display: block;
      }

      /* Overlay when sidebar open */
      .sidebar-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 90;
      }

      .sidebar-overlay.show {
        display: block;
      }
    }

    /* Welcome Card */
    .welcome-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 32px;
      border-radius: 16px;
      margin-bottom: 24px;
    }

    .welcome-card h1 {
      font-size: 28px;
      margin: 0 0 8px;
    }

    .welcome-card p {
      opacity: 0.9;
      margin: 0;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
    }

    .stat-label {
      color: #64748b;
      font-size: 13px;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: #0f172a;
    }

    .stat-change {
      font-size: 12px;
      margin-top: 8px;
    }

    .stat-change.up {
      color: #16a34a;
    }

    .stat-change.down {
      color: #ef4444;
    }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-logo">
      <img src="/public/logo.png" alt="Logo" onerror="this.style.display='none'">
      <div class="sidebar-logo-text">SHOP HUY VÂN</div>
    </div>

    <nav class="sidebar-menu">
      <!-- Main Menu -->
      <div class="menu-section">
        <div class="menu-section-title">Quản lý chính</div>
        
        <a href="/orders.html" class="menu-item">
          <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
          </svg>
          Đơn Hàng
        </a>

        <a href="/products.html" class="menu-item">
          <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
          </svg>
          Sản Phẩm
        </a>

        <a href="/vouchers.html" class="menu-item">
          <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
          </svg>
          Vouchers
        </a>

        <a href="/banners.html" class="menu-item">
          <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          Banners
        </a>

        <a href="/categories.html" class="menu-item">
          <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
          </svg>
          Danh Mục
        </a>

        <a href="/stats.html" class="menu-item">
          <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
          </svg>
          Thống Kê
        </a>

        <a href="/shipping.html" class="menu-item">
          <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16V6a1 1 0 00-1-1H4a1 1 0 00-1 1v10a1 1 0 001 1h1m8-1a1 1 0 01-1 1H9m4-1V8a1 1 0 011-1h2.586a1 1 0 01.707.293l3.414 3.414a1 1 0 01.293.707V16a1 1 0 01-1 1h-1m-6-1a1 1 0 001 1h1M5 17a2 2 0 104 0m-4 0a2 2 0 114 0m6 0a2 2 0 104 0m-4 0a2 2 0 114 0"/>
          </svg>
          Vận Chuyển
        </a>
      </div>

      <!-- Admin Section -->
      <div class="menu-section">
        <div class="menu-section-title">Quản trị viên</div>
        
        <a href="/admin-users.html" class="menu-item">
          <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
          </svg>
          Danh Sách Admin
        </a>

        <a href="/admin-roles.html" class="menu-item">
          <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
          </svg>
          Phân Quyền
        </a>

        <a href="/admin-logs.html" class="menu-item">
          <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          Lịch Sử Hoạt Động
        </a>
      </div>

      <!-- Settings -->
      <div class="menu-section">
        <div class="menu-section-title">Cài đặt</div>
        
        <a href="/ads.html" class="menu-item">
          <svg class="menu-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"/>
          </svg>
          Marketing & Ads
        </a>
      </div>
    </nav>

    <!-- Sidebar Footer -->
    <div style="padding: 16px; border-top: 1px solid #e5e7eb;">
      <div style="font-size: 11px; color: #94a3b8;">
        API: <span data-api-base></span>
      </div>
    </div>
  </aside>

  <!-- Sidebar Overlay (Mobile) -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Main Content -->
  <div class="main-content" id="mainContent">
    <!-- Top Bar -->
    <div class="topbar">
      <div class="topbar-left">
        <button class="menu-toggle" id="menuToggle">
          <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
        <div class="topbar-title">Trang Chủ</div>
      </div>

      <div class="topbar-right">
        <div class="topbar-user" onclick="toggleUserMenu()">
          <div class="topbar-avatar" id="userAvatar">A</div>
          <div style="display: flex; flex-direction: column;">
            <div style="font-size: 13px; font-weight: 600;" id="userName">Admin</div>
            <div style="font-size: 11px; color: #64748b;" id="userRole">Super Admin</div>
          </div>
        </div>
        <button class="btn danger" onclick="logout()">Đăng xuất</button>
      </div>
    </div>

    <!-- Content Area -->
    <div class="content-area" id="contentArea">
      <!-- Welcome Card -->
      <div class="welcome-card">
        <h1>Chào mừng trở lại!</h1>
        <p>Quản lý cửa hàng của bạn một cách dễ dàng và hiệu quả</p>
      </div>

      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Đơn hàng hôm nay</div>
          <div class="stat-value" id="statOrders">0</div>
          <div class="stat-change up">↑ 12% so với hôm qua</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Doanh thu hôm nay</div>
          <div class="stat-value" id="statRevenue">0₫</div>
          <div class="stat-change up">↑ 8% so với hôm qua</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Sản phẩm</div>
          <div class="stat-value" id="statProducts">0</div>
          <div class="stat-change">Tổng số sản phẩm</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Khách hàng mới</div>
          <div class="stat-value" id="statCustomers">0</div>
          <div class="stat-change up">↑ 3 so với tuần trước</div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="card">
        <h3 style="margin: 0 0 16px;">Hành động nhanh</h3>
        <div class="flex">
          <a href="/product_edit.html" class="btn primary">+ Thêm sản phẩm mới</a>
          <a href="/orders.html" class="btn">Xem đơn hàng</a>
          <a href="/stats.html" class="btn">Xem báo cáo</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="./admin_real.js"></script>
  <script>
    // Mobile menu toggle
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebarOverlay');
    const menuToggle = document.getElementById('menuToggle');

    menuToggle?.addEventListener('click', () => {
      sidebar.classList.toggle('open');
      overlay.classList.toggle('show');
    });

    overlay?.addEventListener('click', () => {
      sidebar.classList.remove('open');
      overlay.classList.remove('show');
    });

    // Set active menu item
    const currentPath = location.pathname;
    document.querySelectorAll('.menu-item').forEach(item => {
      if (item.getAttribute('href') === currentPath) {
        item.classList.add('active');
      }
    });

    // User menu toggle
    function toggleUserMenu() {
      // TODO: Implement dropdown menu
      console.log('User menu clicked');
    }

    // Logout
    function logout() {
      if (confirm('Bạn có chắc muốn đăng xuất?')) {
        Admin.token('');
        location.href = '/login_admin.html';
      }
    }

    // Load user info
    async function loadUserInfo() {
      try {
        const me = await Admin.me();
        if (me && me.ok && me.admin) {
          const admin = me.admin;
          document.getElementById('userName').textContent = admin.full_name || admin.email;
          document.getElementById('userRole').textContent = admin.role?.name || 'Admin';
          
          // Set avatar letter
          const firstLetter = (admin.full_name || admin.email || 'A').charAt(0).toUpperCase();
          document.getElementById('userAvatar').textContent = firstLetter;
        }
      } catch(e) {
        console.warn('Load user info failed:', e);
      }
    }

    // Load stats (mock data for now)
    async function loadStats() {
      // TODO: Replace with real API calls
      document.getElementById('statOrders').textContent = '24';
      document.getElementById('statRevenue').textContent = '12.450.000₫';
      document.getElementById('statProducts').textContent = '156';
      document.getElementById('statCustomers').textContent = '8';
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      Admin.ensureAuth();
      loadUserInfo();
      loadStats();
    });
  </script>
</body>
</html>
