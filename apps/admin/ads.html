<!doctype html>
<html lang='vi'>
<head>
  <meta charset='utf-8'/>
  <meta name='viewport' content='width=device-width,initial-scale=1'/>
  <title>Quáº£ng cÃ¡o Facebook</title>
  <link rel="stylesheet" href="./styles.css"/>
  <link rel="stylesheet" href="./ads-analytics-ui.css?v=1"/>
  <script src="./admin_real.js?v=25"></script>
  <script src="./ads_real.js?v=1"></script>
  <script src="./ads-dashboard.js?v=1"></script>
  <script src="./ads-automation.js?v=1"></script>
  <style>
    .tabs { display:flex; gap:8px; margin-bottom:16px; border-bottom:2px solid var(--border); }
    
    /* Automation Styles */
    .rule-card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; margin-bottom:12px; }
    .rule-card.rule-inactive { opacity:0.7; background:#f9fafb; }
    .rule-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
    .rule-info { display:flex; align-items:center; gap:12px; }
    .rule-icon { font-size:24px; }
    .rule-name { font-size:15px; font-weight:600; color:#111827; }
    .rule-type { font-size:12px; color:#6b7280; }
    .rule-actions { display:flex; gap:8px; }
    .btn-icon { background:none; border:1px solid #e5e7eb; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:16px; }
    .btn-icon:hover { background:#f3f4f6; }
    .btn-icon.btn-danger:hover { background:#fee2e2; border-color:#fca5a5; }
    .rule-body { padding:12px 0; border-top:1px solid #f3f4f6; border-bottom:1px solid #f3f4f6; }
    .rule-conditions, .rule-actions-desc { font-size:13px; color:#374151; margin-bottom:8px; }
    .rule-footer { display:flex; justify-content:space-between; margin-top:12px; }
    .rule-stat { font-size:12px; color:#6b7280; }
    .schedule-card { background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:16px; margin-bottom:12px; }
    .schedule-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
    .schedule-name { font-size:15px; font-weight:600; }
    .badge-scheduled { background:#dbeafe; color:#1e40af; padding:4px 8px; border-radius:4px; font-size:11px; font-weight:600; }
    .badge-running { background:#d1fae5; color:#065f46; padding:4px 8px; border-radius:4px; font-size:11px; font-weight:600; }
    .badge-ended { background:#e5e7eb; color:#374151; padding:4px 8px; border-radius:4px; font-size:11px; font-weight:600; }
    .schedule-body { padding-top:8px; }
    .schedule-time { display:flex; justify-content:space-between; margin-bottom:6px; font-size:13px; }
    .schedule-label { color:#6b7280; }
    .schedule-value { color:#111827; font-weight:500; }
    .empty-state { text-align:center; padding:40px 20px; }
    .empty-icon { font-size:48px; margin-bottom:12px; }
    .empty-text { font-size:16px; font-weight:600; color:#374151; margin-bottom:4px; }
    .empty-hint { font-size:13px; color:#6b7280; }
    .tab { padding:10px 16px; cursor:pointer; border-bottom:3px solid transparent; font-weight:500; }
    .tab.active { border-bottom-color:var(--accent); color:var(--accent); }
    .tab-content { display:none; }
    .tab-content.active { display:block; }
    .campaign-card { border:1px solid var(--border); border-radius:12px; padding:16px; margin-bottom:12px; background:#fff; }
    .campaign-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
    .campaign-name { font-size:16px; font-weight:600; }
    .campaign-status { padding:4px 10px; border-radius:6px; font-size:12px; font-weight:600; }
    .campaign-status.active { background:#d1fae5; color:#065f46; }
    .campaign-status.paused { background:#fed7aa; color:#92400e; }
    .campaign-stats { display:grid; grid-template-columns:repeat(auto-fit, minmax(120px, 1fr)); gap:12px; margin-top:12px; }
    .stat-box { background:#f9fafb; padding:12px; border-radius:8px; text-align:center; }
    .stat-value { font-size:20px; font-weight:700; color:var(--accent); }
    .stat-label { font-size:12px; color:var(--muted); margin-top:4px; }
    .product-selector { max-height:300px; overflow-y:auto; border:1px solid var(--border); border-radius:8px; padding:12px; }
    .product-item { display:flex; align-items:center; gap:12px; padding:8px; border-bottom:1px solid var(--border); }
    .product-item:last-child { border-bottom:none; }
    .product-item input[type="checkbox"] { width:20px; height:20px; cursor:pointer; }
    .product-thumb { width:50px; height:50px; object-fit:cover; border-radius:6px; }
    .loading { text-align:center; padding:40px; color:var(--muted); }
  </style>
</head>
<body>
<div class='container'>
  <div class='header'>
    <div class='title'>ğŸ¯ Quáº£ng cÃ¡o Facebook</div>
    <div class='nav'>
      <a href='./products.html' class='badge'>Sáº£n pháº©m</a>
      <a href='./banners.html' class='badge'>Banner</a>
      <a href='./orders.html' class='badge'>ÄÆ¡n hÃ ng</a>
      <a href='./stats.html' class='badge'>Thá»‘ng kÃª</a>
      <a href='./ads.html' class='badge'>Quáº£ng cÃ¡o</a>
      <span class='badge'>API: <span data-api-base></span></span>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab active" data-tab="dashboard">ğŸ“ˆ Dashboard</div>
    <div class="tab" data-tab="campaigns">ğŸ“Š Campaigns</div>
    <div class="tab" data-tab="create">â• Táº¡o má»›i</div>
    <div class="tab" data-tab="automation">ğŸ¤– Automation</div>
    <div class="tab" data-tab="autopost">ğŸ“ ÄÄƒng bÃ i Fanpage</div>
    <div class="tab" data-tab="abtest">ğŸ§ª A/B Testing</div>
    <div class="tab" data-tab="settings">âš™ï¸ CÃ i Ä‘áº·t</div>
  </div>

  <!-- Tab: Dashboard Analytics -->
  <div id="tab-dashboard" class="tab-content active">
    <div id="dashboardContainer" class="dashboard-loading">
      Äang táº£i dashboard...
    </div>
  </div>

  <!-- Tab: Campaigns List -->
  <div id="tab-campaigns" class="tab-content">
    <div class="toolbar">
      <button id="btnRefreshCampaigns" class="btn primary">ğŸ”„ LÃ m má»›i</button>
      <button id="btnTestConnection" class="btn">ğŸ”— Test káº¿t ná»‘i</button>
    </div>
    <div id="campaignsList" class="loading">Äang táº£i...</div>
  </div>

  <!-- Tab: Create Campaign -->
  <div id="tab-create" class="tab-content">
    </div>

  <div id="tab-autopost" class="tab-content">
    <div class="card">
      <h3>Táº¡o bÃ i Ä‘Äƒng Fanpage (Dark Post)</h3>
      <p class="hint">Táº¡o má»™t bÃ i Ä‘Äƒng áº©n Ä‘á»ƒ dÃ¹ng cho quáº£ng cÃ¡o.</p>
      
      <label>Chá»n 1 sáº£n pháº©m Ä‘á»ƒ láº¥y thÃ´ng tin</label>
      <div id="postProductSelector" class="product-selector" style="max-height: 200px;">
        <div class="loading">Äang táº£i sáº£n pháº©m...</div>
      </div>
      
      <label>Ná»™i dung Caption (AI sáº½ tá»± Ä‘á»™ng Ä‘iá»n vÃ o Ä‘Ã¢y)</label>
      <textarea id="postCaption" class="input" rows="5" placeholder="Ná»™i dung bÃ i Ä‘Äƒng..."></textarea>
      
      <label>Loáº¡i bÃ i Ä‘Äƒng</label>
      <select id="postType" class="input">
        <option value="single_image">1 áº£nh (láº¥y áº£nh Ä‘áº§u tiÃªn cá»§a SP)</option>
        <option value="carousel">Carousel (láº¥y 3 áº£nh Ä‘áº§u cá»§a SP)</option>
      </select>
      
      <label>Call-to-Action</label>
      <select id="postCTA" class="input">
        <option value="SHOP_NOW">Mua ngay</option>
        <option value="LEARN_MORE">TÃ¬m hiá»ƒu thÃªm</option>
        <option value="MESSAGE_PAGE">Gá»­i tin nháº¯n</option>
      </select>
      
      <button id="btnCreatePost" class="btn primary" style="margin-top:16px; width:100%;">ğŸš€ ÄÄƒng (Dark Post)</button>
      
      <div id="postResult" style="margin-top: 16px; display: none;">
        <label>Post ID (dÃ¹ng Ä‘á»ƒ táº¡o Ads):</label>
        <input id="postResultId" class="input" readonly/>
      </div>
    </div>
  </div>

  <div id="tab-abtest" class="tab-content">
    <div class="row">
      <div class="col" style="flex: 1.5;">
        <div class="card">
          <h3>Táº¡o A/B Test má»›i</h3>
          <label>TÃªn A/B Test Campaign *</label>
          <input id="abTestName" class="input" placeholder="VD: Test Ke GÃ³c Tam GiÃ¡c"/>
          
          <label>NgÃ¢n sÃ¡ch hÃ ng ngÃ y (VNÄ) *</label>
          <input id="abTestBudget" type="number" class="input" value="100000"/>
          
          <label>Chá»n 1 sáº£n pháº©m Ä‘á»ƒ test</label>
          <div id="abTestProductSelector" class="product-selector" style="max-height: 200px;">
            <div class="loading">Äang táº£i sáº£n pháº©m...</div>
          </div>
          
          <hr/>
          <h4>CÃ¡c biáº¿n thá»ƒ (Creatives)</h4>
          
          <div class="variant-card" style="border:1px solid var(--border); padding:12px; border-radius:8px; margin-bottom:12px;">
            <label><strong>Creative A (áº¢nh 1 + Caption ngáº¯n)</strong></label>
            <input id="abTestImageA" class="input" placeholder="Tá»± Ä‘á»™ng láº¥y áº£nh 1 cá»§a SP" disabled/>
            <textarea id="abTestCaptionA" class="input" rows="2" placeholder="Caption ngáº¯n..."></textarea>
          </div>
          
          <div class="variant-card" style="border:1px solid var(--border); padding:12px; border-radius:8px; margin-bottom:12px;">
            <label><strong>Creative B (áº¢nh 2 + Caption dÃ i)</strong></label>
            <input id="abTestImageB" class="input" placeholder="Tá»± Ä‘á»™ng láº¥y áº£nh 2 cá»§a SP" disabled/>
            <textarea id="abTestCaptionB" class="input" rows="4" placeholder="Caption dÃ i hÆ¡n..."></textarea>
          </div>
          
          <button id="btnCreateABTest" class="btn green" style="margin-top:16px; width:100%;">ğŸ§ª Báº¯t Ä‘áº§u A/B Test</button>
        </div>
      </div>
      
      <div class="col" style="flex: 2;">
        <div class="card">
          <h3>Performance Dashboard</h3>
          <p class="hint">Káº¿t quáº£ A/B test (Ä‘ang cháº¡y hoáº·c Ä‘Ã£ hoÃ n táº¥t)</p>
          <label>Nháº­p Ad Set ID Ä‘á»ƒ xem káº¿t quáº£:</label>
          <div style="display: flex; gap: 8px;">
            <input id="abTestAdSetIdInput" class="input" placeholder="Ad Set ID..."/>
            <button id="btnFetchABTestResults" class="btn primary">Xem</button>
          </div>
          
          <div id="abTestResultsContainer" style="margin-top: 16px;">
            <div class="loading">ChÆ°a cÃ³ dá»¯ liá»‡u</div>
          </div>
        </div>
      </div>
    </div>
  </div>
    <div class="card">
      <h3>Táº¡o Campaign má»›i</h3>
      <label>TÃªn Campaign *</label>
      <input id="campaignName" class="input" placeholder="VD: Black Friday Sale 2025"/>
      
      <label>NgÃ¢n sÃ¡ch hÃ ng ngÃ y (VNÄ) *</label>
      <input id="campaignBudget" type="number" class="input" placeholder="100000" value="100000"/>
      
      <label>Má»¥c tiÃªu</label>
      <select id="campaignObjective" class="input">
        <option value="OUTCOME_SALES">BÃ¡n hÃ ng</option>
        <option value="OUTCOME_TRAFFIC">LÆ°u lÆ°á»£ng truy cáº­p</option>
        <option value="OUTCOME_ENGAGEMENT">TÆ°Æ¡ng tÃ¡c</option>
      </select>

      <hr/>
      <h4>Chá»n sáº£n pháº©m (tá»‘i Ä‘a 10)</h4>
      <div id="productSelector" class="product-selector">
        <div class="loading">Äang táº£i sáº£n pháº©m...</div>
      </div>

      <hr/>
      <h4>Targeting (tÃ¹y chá»n)</h4>
      <div class="row">
        <div class="col">
          <label>Äá»™ tuá»•i tá»«</label>
          <input id="targetAgeMin" type="number" class="input" value="18" min="18" max="65"/>
        </div>
        <div class="col">
          <label>Äá»™ tuá»•i Ä‘áº¿n</label>
          <input id="targetAgeMax" type="number" class="input" value="65" min="18" max="65"/>
        </div>
      </div>

      <button id="btnCreateCampaign" class="btn green" style="margin-top:16px; width:100%;">ğŸš€ Táº¡o Campaign</button>
    </div>
  </div>

  <!-- Tab: Automation & Scheduling -->
  <div id="tab-automation" class="tab-content">
    <div class="row">
      <!-- Left: Create Rules -->
      <div class="col" style="flex:1.2;">
        <div class="card">
          <h3>â¸ï¸ Auto-Pause Rule</h3>
          <p class="hint">Tá»± Ä‘á»™ng táº¡m dá»«ng ads khi hiá»‡u suáº¥t kÃ©m</p>
          
          <label>TÃªn Rule *</label>
          <input id="autoPauseRuleName" class="input" placeholder="VD: Pause CTR < 0.5%"/>
          
          <label>CTR Threshold (%) *</label>
          <input id="autoPauseCTR" type="number" class="input" value="0.5" step="0.1" min="0.1" max="10"/>
          
          <label>Thá»i gian cháº¡y tá»‘i thiá»ƒu (giá») *</label>
          <input id="autoPauseDuration" type="number" class="input" value="48" min="24" max="168"/>
          
          <button id="btnCreateAutoPauseRule" class="btn primary" style="margin-top:12px; width:100%;">â• Táº¡o Rule</button>
        </div>
        
        <div class="card" style="margin-top:16px;">
          <h3>ğŸ“ˆ Budget Scaling Rule</h3>
          <p class="hint">Tá»± Ä‘á»™ng tÄƒng ngÃ¢n sÃ¡ch cho campaigns hiá»‡u quáº£ cao</p>
          
          <label>TÃªn Rule *</label>
          <input id="budgetScaleRuleName" class="input" placeholder="VD: Scale ROAS > 3x"/>
          
          <label>ROAS Threshold (x) *</label>
          <input id="budgetScaleROAS" type="number" class="input" value="3.0" step="0.1" min="0.5" max="10"/>
          
          <label>TÄƒng ngÃ¢n sÃ¡ch (%) *</label>
          <input id="budgetScalePercent" type="number" class="input" value="20" min="5" max="100"/>
          
          <button id="btnCreateBudgetScaleRule" class="btn primary" style="margin-top:12px; width:100%;">â• Táº¡o Rule</button>
        </div>
        
        <div class="card" style="margin-top:16px;">
          <h3>ğŸ“… Schedule Campaign</h3>
          <p class="hint">LÃªn lá»‹ch tá»± Ä‘á»™ng báº­t/táº¯t campaign</p>
          
          <label>TÃªn Campaign *</label>
          <input id="scheduleCampaignName" class="input" placeholder="VD: Black Friday 2025"/>
          
          <label>Thá»i gian báº¯t Ä‘áº§u *</label>
          <input id="scheduleStartTime" type="datetime-local" class="input"/>
          
          <label>Thá»i gian káº¿t thÃºc (tÃ¹y chá»n)</label>
          <input id="scheduleEndTime" type="datetime-local" class="input"/>
          
          <label>NgÃ¢n sÃ¡ch hÃ ng ngÃ y (VNÄ) *</label>
          <input id="scheduleDailyBudget" type="number" class="input" value="100000" min="50000"/>
          
          <button id="btnCreateSchedule" class="btn green" style="margin-top:12px; width:100%;">ğŸ“… Táº¡o lá»‹ch</button>
        </div>
      </div>
      
      <!-- Right: Active Rules & Schedules -->
      <div class="col" style="flex:2;">
        <div class="card">
          <div class="toolbar">
            <h3 style="margin:0;">ğŸ¤– Automation Rules Ä‘ang hoáº¡t Ä‘á»™ng</h3>
            <div style="display:flex; gap:8px;">
              <button id="btnRefreshRules" class="btn">ğŸ”„ LÃ m má»›i</button>
              <button id="btnTestCron" class="btn primary">ğŸ§ª Test Cron</button>
            </div>
          </div>
          <div id="automationRulesContainer" class="loading">Äang táº£i rules...</div>
        </div>
        
        <div class="card" style="margin-top:16px;">
          <div class="toolbar">
            <h3 style="margin:0;">ğŸ“… Campaigns Ä‘Ã£ lÃªn lá»‹ch</h3>
            <button id="btnRefreshSchedules" class="btn">ğŸ”„ LÃ m má»›i</button>
          </div>
          <div id="scheduledCampaignsContainer" class="loading">Äang táº£i schedules...</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Tab: Settings -->
  <div id="tab-settings" class="tab-content">
    <div class="card">
      <h3>Cáº¥u hÃ¬nh Facebook Pixel & Credentials</h3>
      <p class="hint">Nháº­p thÃ´ng tin tá»« Facebook Business Manager</p>
      
      <label>Facebook App ID</label>
      <input id="fbAppId" class="input" placeholder="123456789012345"/>
      
      <label>Facebook App Secret</label>
      <input id="fbAppSecret" class="input" type="password" placeholder="abcdef..."/>
      
      <label>Access Token (Long-lived)</label>
      <input id="fbAccessToken" class="input" type="password" placeholder="EAAxxxx..."/>
      
      <label>Ad Account ID</label>
      <input id="fbAdAccountId" class="input" placeholder="act_123456789"/>
      
      <label>Facebook Page ID</label>
      <input id="fbPageId" class="input" placeholder="123456789012345"/>
      
      <hr/>
      
      <label>Facebook Pixel ID</label>
      <input id="fbPixel" class="input" placeholder="123456789012345"/>
      
      <button id="btnSaveSettings" class="btn primary" style="margin-top:16px; width:100%;">ğŸ’¾ LÆ°u cáº¥u hÃ¬nh</button>
    </div>
  </div>

</div>

<script>
// Logic Ä‘Ã£ Ä‘Æ°á»£c chuyá»ƒn sang ads_real.js
// File nÃ y chá»‰ cÃ²n phá»¥c vá»¥ má»¥c Ä‘Ã­ch tham kháº£o cáº¥u trÃºc HTML
</script>