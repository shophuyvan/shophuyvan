<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tùy chỉnh giao diện - Shop Huy Vân</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
<header class="sticky top-0 z-40 bg-white border-b">
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
    <h1 class="text-xl font-semibold">Tùy chỉnh giao diện</h1>
    <div class="flex gap-2">
      <button id="btnDownloadJSON" class="px-3 py-2 rounded-lg border bg-white">Tải site-config.json</button>
      <button id="btnMakeZip" class="px-3 py-2 rounded-lg border bg-blue-600 text-white">Đóng gói ZIP để up GitHub</button>
    </div>
  </div>
</header>

<main class="max-w-6xl mx-auto px-4 py-6 space-y-8">
  <!-- HERO -->
  <section class="bg-white border rounded-2xl p-4">
    <h2 class="text-lg font-semibold mb-3">Hero banner</h2>
    <div class="grid md:grid-cols-2 gap-4">
      <div class="space-y-3">
        <label class="block">
          <span class="text-sm">Tiêu đề</span>
          <input id="heroTitle" class="mt-1 w-full border rounded-lg p-2" placeholder="Gia dụng thông minh, giá tốt mỗi ngày"/>
        </label>
        <label class="block">
          <span class="text-sm">Mô tả</span>
          <input id="heroSubtitle" class="mt-1 w-full border rounded-lg p-2" placeholder="Rẻ hơn sàn 10–30% • Freeship từ 150K"/>
        </label>
        <div class="text-sm font-medium mt-2">Buttons</div>
        <div id="heroButtons" class="space-y-2"></div>
        <button id="addHeroBtn" class="px-3 py-1.5 rounded-lg border">+ Thêm nút</button>
      </div>
      <div class="space-y-3">
        <div class="text-sm font-medium">Ảnh</div>
        <label class="block">Desktop (1920×600)
          <input id="heroImgDesktop" class="mt-1 w-full border rounded-lg p-2" placeholder="./assets/banners/hero-desktop.png"/>
        </label>
        <label class="block">Tablet (1200×500)
          <input id="heroImgTablet" class="mt-1 w-full border rounded-lg p-2" placeholder="./assets/banners/hero-tablet.png"/>
        </label>
        <label class="block">Mobile (720×400)
          <input id="heroImgMobile" class="mt-1 w-full border rounded-lg p-2" placeholder="./assets/banners/hero-mobile.png"/>
        </label>
      </div>
    </div>
  </section>

  <!-- CATEGORIES -->
  <section class="bg-white border rounded-2xl p-4">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold">Category banners</h2>
      <button id="addCat" class="px-3 py-1.5 rounded-lg border">+ Thêm</button>
    </div>
    <div id="cats" class="mt-3 space-y-3"></div>
  </section>

  <!-- MINIS -->
  <section class="bg-white border rounded-2xl p-4">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold">Mini banners</h2>
      <button id="addMini" class="px-3 py-1.5 rounded-lg border">+ Thêm</button>
    </div>
    <div id="minis" class="mt-3 space-y-3"></div>
  </section>

  <div class="text-sm text-slate-500">
    <p><strong>Lưu ý upload ảnh:</strong> Với hosting tĩnh (Pages/GitHub), bạn hãy kéo ảnh vào thư mục <code>apps/fe/assets/banners/</code> của repo, sau đó dán đường dẫn vào ô ảnh ở trên.</p>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script>
const $ = (s, el=document)=>el.querySelector(s);
let cfg = null;

function makeButtonRow(item, idx, arrName){
  const wrap = document.createElement('div');
  wrap.className = "flex gap-2 items-center";
  wrap.innerHTML = `
    <input class="border rounded-lg p-2 grow" placeholder="Nhãn" value="${item.label||''}">
    <input class="border rounded-lg p-2 grow" placeholder="Link" value="${item.href||'#'}">
    <label class="text-sm flex items-center gap-1"><input type="checkbox" ${item.primary?'checked':''}> Primary</label>
    <button class="border rounded-lg px-2 py-1">Xoá</button>
  `;
  const [label, href, primary, delBtn] = wrap.querySelectorAll('input,button');
  delBtn.onclick = ()=>{ cfg.hero.buttons.splice(idx,1); redraw(); };
  label.oninput = ()=>{ item.label = label.value; };
  href.oninput = ()=>{ item.href = href.value; };
  primary.onchange = ()=>{ item.primary = primary.checked; };
  return wrap;
}

function makeRow(item, idx, arr, arrName){
  const row = document.createElement('div');
  row.className = "grid md:grid-cols-3 gap-2 items-start border rounded-xl p-2";
  row.innerHTML = `
    <input class="border rounded-lg p-2" placeholder="Tiêu đề" value="${item.title||''}">
    <input class="border rounded-lg p-2" placeholder="Link" value="${item.href||'#'}">
    <div class="flex gap-2">
      <input class="border rounded-lg p-2 grow" placeholder="Ảnh (URL)" value="${item.img||''}">
      <button class="border rounded-lg px-2 py-1">Xoá</button>
    </div>
  `;
  const [title, href, img, delBtn] = [row.children[0], row.children[1], row.children[2].querySelector('input'), row.children[2].querySelector('button')];
  title.oninput = ()=>{ item.title = title.value; };
  href.oninput = ()=>{ item.href = href.value; };
  img.oninput = ()=>{ item.img = img.value; };
  delBtn.onclick = ()=>{ arr.splice(idx,1); redraw(); };
  return row;
}

function redraw(){
  // HERO
  $('#heroTitle').value = cfg.hero.title||'';
  $('#heroSubtitle').value = cfg.hero.subtitle||'';
  $('#heroImgDesktop').value = cfg.hero.images.desktop||'';
  $('#heroImgTablet').value = cfg.hero.images.tablet||'';
  $('#heroImgMobile').value = cfg.hero.images.mobile||'';

  const btnWrap = $('#heroButtons');
  btnWrap.innerHTML = '';
  (cfg.hero.buttons||[]).forEach((b,i)=> btnWrap.appendChild(makeButtonRow(b,i,'buttons')));

  // Cats
  const cats = $('#cats'); cats.innerHTML = '';
  (cfg.categories||[]).forEach((c,i)=> cats.appendChild(makeRow(c,i,cfg.categories,'categories')));

  // Minis
  const minis = $('#minis'); minis.innerHTML = '';
  (cfg.minis||[]).forEach((m,i)=> minis.appendChild(makeRow(m,i,cfg.minis,'minis')));
}

async function loadCfg(){
  try{
    const r = await fetch('/apps/fe/assets/site-config.json', {cache:'no-store'});
    cfg = await r.json();
  }catch(e){
    cfg = { hero:{title:'',subtitle:'',buttons:[],images:{}}, categories:[], minis:[] };
  }
  redraw();
}

// events
$('#addHeroBtn').onclick = ()=>{ cfg.hero.buttons.push({label:'Nút mới',href:'#',primary:false}); redraw(); };
$('#addCat').onclick = ()=>{ cfg.categories.push({title:'Danh mục mới',href:'#',img:''}); redraw(); };
$('#addMini').onclick = ()=>{ cfg.minis.push({title:'Mini banner',href:'#',img:''}); redraw(); };

// bind input changes
$('#heroTitle').oninput = e=> cfg.hero.title = e.target.value;
$('#heroSubtitle').oninput = e=> cfg.hero.subtitle = e.target.value;
$('#heroImgDesktop').oninput = e=> cfg.hero.images.desktop = e.target.value;
$('#heroImgTablet').oninput = e=> cfg.hero.images.tablet = e.target.value;
$('#heroImgMobile').oninput = e=> cfg.hero.images.mobile = e.target.value;

// download JSON
$('#btnDownloadJSON').onclick = ()=>{
  const blob = new Blob([JSON.stringify(cfg, null, 2)], {type: 'application/json'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'site-config.json'; a.click();
};

// make ZIP (config only)
$('#btnMakeZip').onclick = async ()=>{
  const zip = new JSZip();
  zip.file('apps/fe/assets/site-config.json', JSON.stringify(cfg, null, 2));
  const blob = await zip.generateAsync({type:'blob'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'patch-site-config.zip'; a.click();
};

loadCfg();
</script>
</body>
</html>
