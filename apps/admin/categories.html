<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Danh m·ª•c ‚Ä¢ Shop Huy V√¢n</title>
  <meta name="description" content="Danh m·ª•c s·∫£n ph·∫©m t·∫°i Shop Huy V√¢n" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/assets/header-shop.css">
</head>
<body class="bg-slate-50">

<header class="header-shop">
  <div class="top">
    <button id="menuBtn" class="icon-btn" aria-label="Menu">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    </button>

    <a href="/" class="logo">
      <img src="/public/logo.png" alt="Logo">
      <div>
        <div class="brand">SHOP HUY V√ÇN</div>
        <div class="sub">Mua B√°n Gi√° S·ªâ</div>
      </div>
    </a>

    <div style="display: flex; align-items: center; gap: 12px; margin-left: auto; margin-right: 8px;">
      <a href="/login.html" id="header-user-btn" class="cart" aria-label="T√†i kho·∫£n">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
      </a>
    </div>

    <a href="/cart.html" class="cart" id="header-cart-btn" aria-label="Gi·ªè h√†ng">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="9" cy="20" r="1"></circle>
        <circle cx="16" cy="20" r="1"></circle>
        <path d="M3 3h2l.4 2M7 13h10l3-8H6.4"></path>
      </svg>
      <span id="cart-badge" class="badge">0</span>
    </a>
  </div>

  <div class="searchbar">
    <div class="wrap">
      <button class="all" id="catBtn" data-cat-menu="1">ALL
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" style="margin-left:6px">
          <path d="M6 9l6 6 6-6"/>
        </svg>
      </button>
      <input id="shv-search" type="search" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m, danh m·ª•c...">
      <button class="go" id="searchGo" aria-label="T√¨m ki·∫øm">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="M21 21l-3.5-3.5"></path>
        </svg>
      </button>
    </div>
  </div>
</header>

<div id="shv-sidebar" aria-hidden="true">
  <div class="mask"></div>
  <aside class="panel">
    <div class="title">Menu</div>
    <div id="sidebar-auth">
      <a href="/login.html" class="item">üîê ƒêƒÉng nh·∫≠p</a>
      <a href="/register.html" class="item">‚úèÔ∏è ƒêƒÉng k√Ω</a>
    </div>
    <a href="/" class="item">üè† Trang ch·ªß</a>
    <a href="/guide.html" class="item">üìò H∆∞·ªõng d·∫´n</a>
    <a href="/policy.html" class="item">üìú Ch√≠nh s√°ch</a>
    <a href="/about.html" class="item">üè™ Th√¥ng tin shop</a>
  </aside>
</div>

<div class="max-w-6xl mx-auto px-4 py-3">
  <nav class="text-sm text-gray-600">
    <a href="/" class="hover:text-blue-600">Trang ch·ªß</a>
    <span class="mx-2">/</span>
    <span class="text-gray-900 font-medium" id="breadcrumb-cat">ƒêang t·∫£i...</span>
  </nav>
</div>

<section class="max-w-6xl mx-auto px-4 mb-6">
  <div class="relative rounded-2xl overflow-hidden bg-gradient-to-r from-blue-500 to-purple-600 h-40">
    <div class="absolute inset-0 flex items-center justify-start px-8">
      <div class="text-white">
        <h1 id="cat-title" class="text-3xl font-bold mb-2">Danh m·ª•c</h1>
        <p id="cat-subtitle" class="text-lg opacity-90">G·ª£i √Ω s·∫£n ph·∫©m ph√π h·ª£p nhu c·∫ßu c·ªßa b·∫°n.</p>
      </div>
    </div>
  </div>
</section>

<section class="max-w-6xl mx-auto px-4 pb-10">
  <div class="flex items-center justify-between mb-4">
    <div class="text-sm text-gray-600">
      T√¨m th·∫•y <span id="total-products" class="font-semibold text-gray-900">0</span> s·∫£n ph·∫©m
    </div>
    <select id="sort-select" class="border rounded-lg px-3 py-2 text-sm">
      <option value="default">Ph·ªï bi·∫øn</option>
      <option value="new">M·ªõi nh·∫•t</option>
      <option value="price-asc">Gi√° tƒÉng d·∫ßn</option>
      <option value="price-desc">Gi√° gi·∫£m d·∫ßn</option>
    </select>
  </div>
  <div id="products-grid" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>
</section>

<footer class="border-t bg-white mt-10">
  <div class="max-w-6xl mx-auto px-4 py-6 grid md:grid-cols-3 gap-4 text-sm">
    <div>
      <div class="font-semibold">Shop Huy V√¢n</div>
      <div>ƒê·ªãa ch·ªâ: 91/6 Li√™n Khu 5-11-12, P. B√¨nh Tr·ªã ƒê√¥ng, TP.HCM</div>
      <div>ƒêi·ªán tho·∫°i: 0933 190 000 (l·∫ª) ¬∑ 0909 128 999 (s·ªâ)</div>
    </div>
    <div>
      <div class="font-semibold">Ch√≠nh s√°ch</div>
      <ul class="list-disc ml-5">
        <li>ƒê·ªïi tr·∫£ trong v√≤ng 14 ng√†y</li>
        <li>Cam k·∫øt Ch·∫•t L∆∞·ª£ng S·∫£n Ph·∫©m</li>
        <li>Mi·ªÖn Ph√≠ Ship T·ª´ 150K</li>
      </ul>
    </div>
    <div>
      <div class="font-semibold">B·∫£n ƒë·ªì</div>
      <iframe class="w-full h-40 border rounded" loading="lazy" src="https://www.google.com/maps?q=91/6%20Li%C3%AAn%20Khu%205-11-12%2C%20B%C3%ACnh%20Tr%E1%BB%8B%20%C4%90%C3%B4ng&output=embed"></iframe>
    </div>
  </div>
</footer>

<script type="module" src="/src/cat-menu.js?v=36"></script>

<script>
(function() {
  const $ = function(s, r) { return (r || document).querySelector(s); };
  const fmt = function(n) { return (Number(n) || 0).toLocaleString('vi-VN') + 'ƒë'; };
  const IMG_FALLBACK = '/public/logo.png';
  
  const params = new URLSearchParams(window.location.search);
  const slug = params.get("c") || params.get("category") || "";
  
  const catName = decodeURIComponent(slug || 'Danh m·ª•c')
    .replace(/-/g, ' ')
    .replace(/\b\w/g, function(m) { return m.toUpperCase(); });
  
  const h1 = $('#shv-h1');
  const leaf = $('#shv-bc-leaf');
  if (h1) h1.textContent = catName;
  if (leaf) leaf.textContent = catName;
  
  const PAGE_SIZE = 40;

  async function loadProducts() {
    try {
      const url = 'https://shv-api.shophuyvan.workers.dev/public/products?category_slug=' + slug;
      const r = await fetch(url);
      const data = await r.json();
      const all = data.items || [];
      
      const totalEl = document.querySelector("#rs-total");
      if (totalEl) totalEl.textContent = all.length;
      
      const grid = document.querySelector("#rs-grid");
      if (!grid) return;
      
      if (!all.length) {
        grid.innerHTML = '<div class="p-4 text-gray-500">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m trong danh m·ª•c n√†y.</div>';
        return;
      }
      
      const tpl = function(p) {
      const img = (p.images && p.images[0]) || IMG_FALLBACK;
      const title = p.title || 'S·∫£n ph·∫©m';
      const vs = Array.isArray(p.variants) ? p.variants : [];
      const saleVals = vs.map(v => Number(v.price_sale ?? v.price ?? 0)).filter(n => n > 0);
      const origVals = vs.map(v => Number(v.price || 0)).filter(n => n > 0);
      const minSale = saleVals.length ? Math.min(...saleVals) : 0;
      const minOrig = origVals.length ? Math.min(...origVals) : 0;
      const sold = p.sold || 0;
    
      const priceHTML =
        '<div class="flex items-baseline gap-2">' +
          '<div class="text-red-600 font-semibold">' + fmt(minSale) + '</div>' +
          (minOrig && minOrig > minSale
            ? '<div class="text-gray-400 line-through text-xs">' + fmt(minOrig) + '</div>'
            : '') +
        '</div>';
    
      return '<a href="/product.html?id=' + p.id + '" class="block border rounded-2xl overflow-hidden hover:shadow-md transition bg-white">' +
        '<div class="relative aspect-[4/3] bg-gray-100">' +
          '<img src="' + img + '" class="absolute inset-0 w-full h-full object-cover" alt="' + title + '" />' +
        '</div>' +
        '<div class="p-3">' +
          '<h3 class="line-clamp-2 text-sm mb-1 min-h-[36px]">' + title + '</h3>' +
          priceHTML +
          '<div class="mt-1 text-xs text-gray-500">ƒê√£ b√°n ' + sold + '</div>' +
        '</div>' +
      '</a>';
    };
          
      grid.innerHTML = all.slice(0, PAGE_SIZE).map(tpl).join("");
      
    } catch (e) {
      console.error("Load products failed", e);
      const grid = document.querySelector("#rs-grid");
      if (grid) {
        grid.innerHTML = '<div class="p-4 text-gray-500">Kh√¥ng t·∫£i ƒë∆∞·ª£c s·∫£n ph·∫©m.</div>';
      }
    }
  }
  
  loadProducts();
})();
</script>
</body>
</html>