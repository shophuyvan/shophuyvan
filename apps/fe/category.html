<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Danh mục • Shop Huy Vân</title>
  <meta name="description" content="Danh mục sản phẩm tại Shop Huy Vân" />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- SEO-INJECTED: canonical & JSON-LD (updated by script) -->
  <link id="canonical" rel="canonical" href="__BASE_URL__/c" />
  <script id="category-jsonld" type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    "name": "Danh mục",
    "url": "__BASE_URL__/c",
    "mainEntity": {
      "@type": "ItemList",
      "itemListElement": []
    }
  }
  </script>
  <style>
    .shv-breadcrumb{font-size:14px;color:#4b5563;display:flex;gap:6px;flex-wrap:wrap;align-items:center;margin:10px auto;max-width:1200px;padding:0 12px}
    .shv-breadcrumb a{color:#2563eb;text-decoration:none}
    .shv-breadcrumb a:hover{text-decoration:underline}
    .shv-breadcrumb .sep{opacity:.5}
    .shv-breadcrumb .last{color:#111827;font-weight:600}
  </style>
</head>
<body class="bg-slate-50 text-gray-900">
  <!-- ===== SHV HOME/CATEGORY v1 (chosidamsen-like) ===== -->
  <main class="max-w-7xl mx-auto px-3 lg:px-6 py-4 lg:py-6">
    <nav class="text-sm text-gray-500 mb-3" aria-label="Breadcrumb">
      <ol class="flex flex-wrap gap-1">
        <li><a href="__BASE_URL__/" class="hover:text-red-600">Trang chủ</a></li>
        <li class="px-1">/</li>
        <li class="text-gray-700 font-medium" id="shv-bc-leaf">Đang tải…</li>
      </ol>
    </nav>
    <section class="rounded-2xl overflow-hidden relative mb-4 lg:mb-6">
      <img id="shv-hero" class="w-full h-40 lg:h-60 object-cover"
           src="/apps/fe/public/cover.jpg" alt="Danh mục">
      <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
      <div class="absolute bottom-3 left-3 right-3 lg:left-6 lg:right-6 text-white">
        <h1 id="shv-h1" class="text-xl lg:text-3xl font-bold">Danh mục</h1>
        <p id="shv-sub" class="opacity-90 text-sm lg:text-base mt-1">
          Gợi ý sản phẩm phù hợp nhu cầu của bạn.
        </p>
      </div>
    </section>

    <div class="grid grid-cols-12 gap-4">
      <aside class="col-span-12 lg:col-span-3">
        <button id="shv-open-filter" class="lg:hidden w-full rounded-xl border py-2.5 font-medium">Bộ lọc</button>
        <div id="shv-filter" class="hidden lg:block lg:sticky lg:top-4 bg-white border rounded-2xl p-3 lg:p-4">
          <div class="mb-4">
            <h3 class="font-semibold mb-2">Khoảng giá</h3>
            <div class="flex gap-2">
              <input id="f-min" type="number" inputmode="numeric" placeholder="từ" class="w-1/2 rounded-lg border px-3 py-2 text-sm">
              <input id="f-max" type="number" inputmode="numeric" placeholder="đến" class="w-1/2 rounded-lg border px-3 py-2 text-sm">
            </div>
          </div>
          <div class="mb-4">
            <h3 class="font-semibold mb-2">Thương hiệu</h3>
            <div id="f-brands" class="space-y-2 text-sm max-h-52 overflow-auto pr-1"></div>
          </div>
          <div class="mb-4">
            <h3 class="font-semibold mb-2">Đánh giá</h3>
            <div class="space-y-2 text-sm">
              <label class="flex items-center gap-2"><input type="radio" name="f-rate" value="4"><span>⭐️⭐️⭐️⭐️ trở lên</span></label>
              <label class="flex items-center gap-2"><input type="radio" name="f-rate" value="3"><span>⭐️⭐️⭐️ trở lên</span></label>
              <label class="flex items-center gap-2"><input type="radio" name="f-rate" value=""><span>Tất cả</span></label>
            </div>
          </div>
          <button id="f-apply" class="w-full rounded-xl bg-red-600 text-white py-2.5 font-semibold">Áp dụng</button>
        </div>
      </aside>

      <section class="col-span-12 lg:col-span-9">
        <div class="flex flex-wrap items-center justify-between gap-2 lg:gap-4 mb-3">
          <div class="text-sm text-gray-600">Tìm thấy <span id="rs-total" class="font-semibold text-gray-800">0</span> sản phẩm</div>
          <div class="flex items-center gap-2">
            <select id="rs-sort" class="border rounded-lg text-sm px-3 py-2">
              <option value="popular">Phổ biến</option>
              <option value="new">Mới nhất</option>
              <option value="price-asc">Giá tăng dần</option>
              <option value="price-desc">Giá giảm dần</option>
            </select>
            <button id="rs-open-filter" class="lg:hidden rounded-lg border px-3 py-2 text-sm">Lọc</button>
          </div>
        </div>
        <div id="rs-grid" class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-3 lg:gap-4"></div>
        <div id="rs-pagination" class="flex justify-center gap-2 mt-5"></div>
        <article id="shv-seo" class="mt-8 lg:mt-12 bg-white border rounded-2xl p-4 lg:p-6 prose prose-sm lg:prose">
          <h2 class="text-xl lg:text-2xl font-bold mb-2" id="seo-title">Giới thiệu</h2>
          <p id="seo-desc">Mô tả danh mục sẽ hiển thị ở đây.</p>
        </article>
      </section>
    </div>
  </main>
  <script type="application/ld+json" id="shv-collection-jsonld">
  {"@context":"https://schema.org","@type":"CollectionPage","name":"Danh mục","hasPart":[]}
  </script>
  <script type="text/template" id="tpl-card">
    <a class="block border rounded-2xl overflow-hidden hover:shadow-md transition bg-white" href="{{url}}">
      <div class="relative aspect-[4/3] bg-gray-100">
        <img class="absolute inset-0 w-full h-full object-cover" src="{{image}}" alt="{{name}}">
        {{#if badge}}<span class="absolute left-2 top-2 text-xs bg-red-600 text-white px-2 py-0.5 rounded-full">{{badge}}</span>{{/if}}
      </div>
      <div class="p-3">
        <h3 class="line-clamp-2 text-sm mb-1 min-h-[36px]">{{name}}</h3>
        <div class="flex items-baseline gap-2">
          <div class="text-red-600 font-semibold">{{price}}</div>
          {{#if crossed}}<div class="text-gray-400 line-through text-xs">{{crossed}}</div>{{/if}}
        </div>
        <div class="mt-1 text-xs text-gray-500">Đã bán {{sold}} • ⭐ {{rating}}</div>
      </div>
    </a>
  </script>
  <script>
  (()=>{
    const state={page:+(new URLSearchParams(location.search).get('page')||1),sort:new URLSearchParams(location.search).get('sort')||'popular',min:+(new URLSearchParams(location.search).get('min')||'')||'',max:+(new URLSearchParams(location.search).get('max')||'')||'',brand:new URLSearchParams(location.search).getAll('brand'),rate:new URLSearchParams(location.search).get('rate')||'',total:0,items:[]};
    const $=(s,r=document)=>r.querySelector(s); const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
    const fmt=n=>(Number(n)||0).toLocaleString('vi-VN')+'đ';
    const IMG_FALLBACK='/public/logo.png'; const PAGE_SIZE=24;
    const path=location.pathname.split('/').filter(Boolean); const slug=(path[0]==='c'&&path[1])?path[1]:new URLSearchParams(location.search).get('c')||'';
    const catName=decodeURIComponent(slug||'Danh mục').replace(/-/g,' ').replace(/\b\w/g,m=>m.toUpperCase());
    $('#shv-h1').textContent=catName; $('#shv-bc-leaf').textContent=catName;
    function tpl(p){const t=$('#tpl-card').textContent; const v={url:p.url||('__BASE_URL__/product/'+(p.slug||p.id||'')),image:p.image||p.images?.[0]||IMG_FALLBACK,name:p.name||p.title||'Sản phẩm',badge:p.sale_off?('-'+p.sale_off+'%'):'',price:fmt(p.sale_price??p.price??0),crossed:p.sale_price?fmt(p.price):'',sold:p.sold??0,rating:(p.rating??4.8).toFixed(1)}; return t.replace('{{url}}',v.url).replace('{{image}}',v.image).replaceAll('{{name}}',v.name).replace('{{badge}}',v.badge||'').replace('{{price}}',v.price).replace('{{crossed}}',v.crossed).replace('{{sold}}',v.sold).replace('{{rating}}',v.rating).replace('{{#if badge}}','').replace('{{/if}}','').replace('{{#if crossed}}','').replace('{{/if}}','');}
    function renderGrid(items){$('#rs-total').textContent=state.total.toLocaleString('vi-VN'); $('#rs-grid').innerHTML=items.map(tpl).join(''); try{const ld=JSON.parse($('#shv-collection-jsonld').textContent); ld.name=catName; ld.hasPart=items.map(i=>({"@type":"Product","name":i.name,"url":i.url||('__BASE_URL__/product/'+(i.slug||i.id||''))})); $('#shv-collection-jsonld').textContent=JSON.stringify(ld);}catch(e){}}
    function renderPagination(){const pages=Math.max(1,Math.ceil(state.total/PAGE_SIZE)); const cur=Math.min(state.page,pages); const mk=(p,l,a=false)=>`<a href="${makeUrl({page:p})}" class="px-3 py-2 rounded-lg border ${a?'bg-red-600 text-white border-red-600':'hover:bg-gray-50'}">${l}</a>`; const arr=[]; if(cur>1)arr.push(mk(cur-1,'‹')); for(let i=Math.max(1,cur-2);i<=Math.min(pages,cur+2);i++)arr.push(mk(i,i,i===cur)); if(cur<pages)arr.push(mk(cur+1,'›')); $('#rs-pagination').innerHTML=arr.join('');}
    function makeUrl(overrides={}){const u=new URL(location.href); const q=u.searchParams; Object.entries({...state,...overrides}).forEach(([k,v])=>{if(['items','total'].includes(k))return; if(Array.isArray(v)){q.delete(k); v.forEach(x=>x&&q.append(k,x));} else if(v===''||v==null) q.delete(k); else q.set(k,v);}); if(slug) q.set('c',slug); return u.pathname+'?'+q.toString();}
    async function load(){ if(Array.isArray(window.__SHV_PRODUCTS__)){ return slice(window.__SHV_PRODUCTS__);} const url='/api/products/by-cat?slug='+encodeURIComponent(slug||''); try{const r=await fetch(url); const data=await r.json(); return slice(data.items||data.data||[]);}catch(e){const mock=Array.from({length:48}).map((_,i)=>({id:i+1,name:`Sản phẩm #${i+1}`,image:IMG_FALLBACK,price:59000+i*1000,sale_price:i%3===0?45000+i*500:0,sale_off:i%3===0?20:0,sold:(i*13)%500,rating:4+(i%10)/10})); return slice(mock);}}
    function slice(all){let a=all.slice(); if(state.min) a=a.filter(p=>(p.sale_price||p.price)>=state.min); if(state.max) a=a.filter(p=>(p.sale_price||p.price)<=state.max); if(state.rate) a=a.filter(p=>(p.rating||0)>=Number(state.rate)); if(state.brand?.length) a=a.filter(p=>state.brand.includes((p.brand||'').toLowerCase())); if(state.sort==='price-asc') a.sort((x,y)=>(x.sale_price||x.price)-(y.sale_price||y.price)); else if(state.sort==='price-desc') a.sort((x,y)=>(y.sale_price||y.price)-(x.sale_price||x.price)); else if(state.sort==='new') a.reverse(); state.total=a.length; const start=(state.page-1)*PAGE_SIZE; const items=a.slice(start,start+PAGE_SIZE); return {items,total:state.total};}
    function renderBrandsFrom(items){const brands=[...new Set(items.map(p=>(p.brand||'').toLowerCase()).filter(Boolean))].slice(0,15); const box=$('#f-brands'); box.innerHTML=brands.map(b=>{const id='b-'+b.replace(/\s+/g,'-'); const checked=state.brand.includes(b)?'checked':''; return `<label class="flex items-center gap-2"><input type="checkbox" value="${b}" ${checked} class="f-brand"> <span class="capitalize">${b}</span></label>`; }).join(''); $$('.f-brand',box).forEach(c=>c.addEventListener('change',()=>{const set=new Set(state.brand); c.checked?set.add(c.value):set.delete(c.value); state.brand=Array.from(set);}));}
    // events
    $('#f-apply').addEventListener('click',()=>{ state.min=+$('#f-min').value||''; state.max=+$('#f-max').value||''; state.rate=($('input[name="f-rate"]:checked')||{}).value||''; state.page=1; location.href=makeUrl(); });
    $('#rs-sort').addEventListener('change',e=>{ state.sort=e.target.value; state.page=1; location.href=makeUrl(); });
    $('#rs-open-filter').addEventListener('click',()=>$('#shv-open-filter').click());
    $('#shv-open-filter').addEventListener('click',()=>{ const p=$('#shv-filter'); p.classList.toggle('hidden'); });
    // run
    load().then(({items})=>{renderGrid(items); renderPagination(); renderBrandsFrom(window.__SHV_PRODUCTS__||items);});
  })();
  </script>
  <!-- ===== /SHV HOME/CATEGORY v1 ===== -->

</body>
</html>
