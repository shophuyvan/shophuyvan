<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuÃªn máº­t kháº©u - Shop Huy VÃ¢n</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="login-container">
    <div class="logo">
      <h1>ğŸ” QuÃªn máº­t kháº©u</h1>
      <p>Nháº­p email hoáº·c SÄT Ä‘á»ƒ nháº­n hÆ°á»›ng dáº«n Ä‘áº·t láº¡i máº­t kháº©u</p>
    </div>

    <form id="forgot-form">
      <div class="form-group">
        <label for="identifier">Email hoáº·c Sá»‘ Ä‘iá»‡n thoáº¡i</label>
        <input
          type="text"
          id="identifier"
          name="identifier"
          placeholder="Nháº­p email hoáº·c sá»‘ Ä‘iá»‡n thoáº¡i"
          required
          autocomplete="username"
        >
      </div>

      <button type="submit" class="btn-login" id="btn-submit">
        Gá»­i yÃªu cáº§u
      </button>
    </form>

    <div class="register-link" style="margin-top: 16px;">
      <a href="/login.html">â† Quay láº¡i Ä‘Äƒng nháº­p</a>
    </div>
  </div>

  <script>
  (function() {
    const API_BASE = window.API_BASE || 'https://api.shophuyvan.vn';

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s ease-out reverse';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    const form = document.getElementById('forgot-form');
    const btnSubmit = document.getElementById('btn-submit');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const identifier = document.getElementById('identifier').value.trim();
      if (!identifier) {
        showToast('Vui lÃ²ng nháº­p email hoáº·c sá»‘ Ä‘iá»‡n thoáº¡i', 'error');
        return;
      }

      btnSubmit.disabled = true;
      btnSubmit.textContent = 'Äang xá»­ lÃ½...';

      try {
        const res = await fetch(`${API_BASE}/auth/password/forgot`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ identifier })
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok || !data.ok) {
          throw new Error(data.error || data.message || 'Gá»­i yÃªu cáº§u tháº¥t báº¡i');
        }

        showToast(
          'Náº¿u tÃ i khoáº£n tá»“n táº¡i, há»‡ thá»‘ng Ä‘Ã£ gá»­i hÆ°á»›ng dáº«n Ä‘áº·t láº¡i máº­t kháº©u.',
          'success'
        );
      } catch (err) {
        console.error('[ForgotPassword] Error:', err);
        showToast(err.message || 'Lá»—i gá»­i yÃªu cáº§u', 'error');
      } finally {
        btnSubmit.disabled = false;
        btnSubmit.textContent = 'Gá»­i yÃªu cáº§u';
      }
    });
  })();
  </script>
</body>
</html>
