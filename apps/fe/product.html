<!--
  FILE PATH: shophuyvan-main/apps/fe/product.html
  
  DESCRIPTION: Trang chi ti·∫øt s·∫£n ph·∫©m v·ªõi UX Shopee/Lazada
  - Header: Back, Share, Cart badge realtime
  - Bottom bar: Chat Zalo, Th√™m gi·ªè h√†ng, Mua ngay
  - Modal variant t·ª± ƒë√≥ng sau khi th√™m
  - Hi·ªÉn th·ªã: S·ªë l∆∞·ª£ng ƒë√£ b√°n, Gi√° g·ªëc g·∫°ch ngang, T·ªìn kho
  
  DEPENDENCIES:
  - /assets/header-shop.css (CSS header)
  - /src/ui-pdp.js (Logic PDP - c·∫ßn update)
  - /src/lib/price.js (Price utils)
  - /src/lib/api.js (API client)
  - /src/cart-badge-realtime.js (Badge sync - file m·ªõi)
-->
<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="page-title">S·∫£n ph·∫©m ‚Ä¢ Shop Huy V√¢n</title>
  <meta name="description" id="page-description" content="Shop Huy V√¢n - ƒêi·ªán gia d·ª•ng, ƒë·ªì l·∫Øp ƒë·∫∑t, ph·ª• ki·ªán th√¥ng minh." />
  <meta name="keywords" id="page-keywords" content="shop huy v√¢n, ƒëi·ªán gia d·ª•ng, ph·ª• ki·ªán th√¥ng minh" />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="product" />
  <meta property="og:site_name" content="Shop Huy V√¢n" />
  <meta property="og:title" id="og-title" content="S·∫£n ph·∫©m ‚Ä¢ Shop Huy V√¢n" />
  <meta property="og:description" id="og-description" content="Shop Huy V√¢n - ƒêi·ªán gia d·ª•ng, ƒë·ªì l·∫Øp ƒë·∫∑t, ph·ª• ki·ªán th√¥ng minh." />
  <meta property="og:image" id="og-image" content="/public/logo.png" />
  <meta property="og:url" id="og-url" content="" />
  <meta property="product:price:amount" id="og-price" content="" />
  <meta property="product:price:currency" content="VND" />
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" id="twitter-title" content="S·∫£n ph·∫©m ‚Ä¢ Shop Huy V√¢n" />
  <meta name="twitter:description" id="twitter-description" content="Shop Huy V√¢n - ƒêi·ªán gia d·ª•ng, ƒë·ªì l·∫Øp ƒë·∫∑t, ph·ª• ki·ªán th√¥ng minh." />
  <meta name="twitter:image" id="twitter-image" content="/public/logo.png" />
  
  <!-- Canonical -->
  <link rel="canonical" id="page-canonical" href="" />
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    /* ==========================================
       SHOPEE-STYLE HEADER (Floating)
       ========================================== */
    .shv-pdp-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: linear-gradient(180deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.2) 50%, transparent 100%);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .shv-icon-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(8px);
      border: none;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .shv-icon-btn:hover {
      background: rgba(0,0,0,0.6);
    }
    
    .shv-cart-badge {
      position: absolute;
      top: -4px;
      right: -4px;
      min-width: 18px;
      height: 18px;
      background: #ef4444;
      color: white;
      font-size: 10px;
      font-weight: bold;
      border-radius: 9px;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 0 4px;
      animation: cart-badge-bounce 0.5s ease-out;
    }
    
    .shv-cart-badge.show {
      display: flex;
    }
    
    @keyframes cart-badge-bounce {
      0%, 100% { transform: scale(1); }
      25% { transform: scale(1.2); }
      50% { transform: scale(0.95); }
      75% { transform: scale(1.1); }
    }
    
    /* ==========================================
       BOTTOM ACTION BAR (Fixed)
       ========================================== */
    .shv-bottom-bar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 100;
      background: white;
      border-top: 1px solid #e5e7eb;
      padding: 10px 16px calc(env(safe-area-inset-bottom, 0px) + 10px);
      box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
    }
    
    .shv-bottom-bar .actions {
      display: flex;
      gap: 10px;
      max-width: 1200px;
      margin: 0 auto;
      align-items: stretch;
    }
    
    .shv-btn-chat {
      flex: 0 0 auto;
      min-width: 70px;
      padding: 10px 12px;
      border: 2px solid #0068FF;
      color: #0068FF;
      background: white;
      border-radius: 12px;
      font-weight: 700;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .shv-btn-chat:hover {
      background: #f0f8ff;
    }
    
    .shv-btn-add {
      flex: 1;
      padding: 10px 14px;
      border: 2px solid #ef4444;
      color: #ef4444;
      background: #fff5f5;
      border-radius: 12px;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .shv-btn-add:hover {
      background: #ffe5e5;
      transform: translateY(-1px);
    }
    
    .shv-btn-buy {
      flex: 1;
      padding: 10px 14px;
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 800;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
      transition: all 0.2s;
    }
    
    .shv-btn-buy:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
    }
    
    /* ==========================================
       SHARE DROPDOWN MENU
       ========================================== */
    .shv-share-menu {
      position: absolute;
      top: 50px;
      right: 0;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      overflow: hidden;
      min-width: 180px;
      display: none;
      z-index: 110;
    }
    
    .shv-share-menu.show {
      display: block;
      animation: slideDown 0.2s ease-out;
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .shv-share-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      cursor: pointer;
      transition: background 0.2s;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .shv-share-item:last-child {
      border-bottom: none;
    }
    
    .shv-share-item:hover {
      background: #f9fafb;
    }
    
    /* ==========================================
       PRODUCT INFO LAYOUT (Gi·ªëng Shopee)
       ========================================== */
    .product-info-grid {
      display: grid;
      gap: 8px;
      margin-top: 12px;
    }
    
    .info-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }
    
    .info-label {
      color: #64748b;
      min-width: 80px;
    }
    
    .info-value {
      font-weight: 600;
      color: #0f172a;
    }
    
    .price-section {
      background: #fafafa;
      padding: 12px;
      border-radius: 8px;
      margin: 12px 0;
    }
    
    .price-original {
      font-size: 14px;
      color: #94a3b8;
      text-decoration: line-through;
      margin-right: 8px;
    }
    
    .price-sale {
      font-size: 24px;
      font-weight: 800;
      color: #ef4444;
    }
    
    .stock-info {
      display: inline-block;
      padding: 4px 12px;
      background: #f0fdf4;
      color: #16a34a;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      margin-top: 8px;
    }
    
    .stock-info.low {
      background: #fef2f2;
      color: #dc2626;
    }
    
    .sold-count {
      color: #64748b;
      font-size: 14px;
    }
    
    /* ==========================================
       RESPONSIVE
       ========================================== */
    @media (max-width: 640px) {
      .shv-btn-chat span {
        display: none;
      }
      
      .shv-btn-add, .shv-btn-buy {
        font-size: 13px;
        padding: 10px 12px;
      }
      
      .shv-icon-btn {
        width: 36px;
        height: 36px;
      }
    }
    
    /* Hide default header on PDP */
    body.pdp header, 
    body.pdp .header-shop {
      display: none !important;
    }
  </style>
  
  <script type="module" src="/src/pixels.js?v=36"></script>
</head>
<body class="bg-slate-50 text-gray-900 pdp">
  
  <!-- ==========================================
       SHOPEE-STYLE HEADER
       ========================================== -->
  <div class="shv-pdp-header">
    <button id="btn-back" class="shv-icon-btn" aria-label="Quay l·∫°i">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
        <path fill-rule="evenodd" d="M15.75 19.5a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 1 1 1.06 1.06L9.06 11.25l6.69 6.69a.75.75 0 0 1 0 1.06z" clip-rule="evenodd" />
      </svg>
    </button>
    
    <div style="display: flex; gap: 8px; align-items: center;">
      <!-- Share button -->
      <div style="position: relative;">
        <button id="btn-share" class="shv-icon-btn" aria-label="Chia s·∫ª">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
            <path fill-rule="evenodd" d="M15.75 4.5a3 3 0 1 1 .825 2.066l-8.421 4.679a3.002 3.002 0 0 1 0 1.51l8.421 4.679a3 3 0 1 1-.729 1.31l-8.421-4.678a3 3 0 1 1 0-4.132l8.421-4.679a3 3 0 0 1-.096-.755Z" clip-rule="evenodd" />
          </svg>
        </button>
        
        <!-- Share dropdown -->
        <div id="share-menu" class="shv-share-menu">
          <div class="shv-share-item" data-type="zalo">
            <div style="width: 32px; height: 32px; background: #0068FF; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px;">Z</div>
            <span style="font-weight: 600; font-size: 14px;">Chia s·∫ª Zalo</span>
          </div>
          <div class="shv-share-item" data-type="facebook">
            <div style="width: 32px; height: 32px; background: #1877F2; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px;">f</div>
            <span style="font-weight: 600; font-size: 14px;">Chia s·∫ª Facebook</span>
          </div>
        </div>
      </div>
      
      <!-- Cart button with badge -->
      <a href="/cart.html" id="btn-cart" class="shv-icon-btn" style="position: relative;" aria-label="Gi·ªè h√†ng">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
          <path d="M2.25 2.25a.75.75 0 0 0 0 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 0 0-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 0 0 0-1.5H5.378A2.25 2.25 0 0 1 7.5 15h11.218a.75.75 0 0 0 .674-.421 60.358 60.358 0 0 0 2.96-7.228.75.75 0 0 0-.525-.965A60.864 60.864 0 0 0 5.68 4.509l-.232-.867A1.875 1.875 0 0 0 3.636 2.25H2.25ZM3.75 20.25a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 20.25a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" />
        </svg>
        <span id="cart-badge" class="shv-cart-badge">0</span>
      </a>
    </div>
  </div>

  <!-- ==========================================
       PRODUCT CONTENT
       ========================================== -->
  <main class="max-w-6xl mx-auto px-4 py-6 pb-32" style="padding-top: 60px;">
    <section class="md:grid md:grid-cols-2 md:gap-6">
      <!-- Media -->
      <div class="space-y-2">
        <div id="media-main" class="relative aspect-square bg-white rounded-lg overflow-hidden"></div>
      </div>
      
      <!-- Info -->
      <div class="space-y-3 mt-4 md:mt-0">
        <h1 id="p-title" class="text-xl md:text-2xl font-semibold"></h1>
        
        <!-- Rating & Sold -->
        <div class="flex items-center gap-4 text-sm">
          <div class="flex items-center gap-1">
            <span id="p-rating" class="text-amber-500">5‚òÖ</span>
          </div>
          <span class="text-gray-300">|</span>
          <div class="sold-count">
            <span id="p-sold">0</span> <span class="text-gray-500">ƒê√£ b√°n</span>
          </div>
        </div>
        
        <!-- Price section (gi·ªëng Shopee) -->
        <div class="price-section">
          <div id="p-price-display">
            <span class="price-original" id="p-price-original" style="display: none;"></span>
            <span class="price-sale" id="p-price-sale">0ƒë</span>
          </div>
        </div>
        
        <!-- Stock -->
        <div>
          <span id="p-stock" class="stock-info">C√≤n h√†ng</span>
        </div>
        
        <!-- Additional info -->
        <div class="product-info-grid">
          <div class="info-row">
            <span class="info-label">Giao h√†ng:</span>
            <span class="info-value">1-3 ng√†y</span>
          </div>
          <div class="info-row">
            <span class="info-label">Freeship:</span>
            <span class="info-value">ƒê∆°n t·ª´ 150K</span>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Description -->
    <section class="mt-6 bg-white rounded-lg p-4 border border-gray-200">
  <h2 class="font-semibold text-lg mb-3 text-gray-900">M√¥ t·∫£ s·∫£n ph·∫©m</h2>
  <article
    id="p-desc"
    class="
      text-[15px] leading-relaxed text-gray-700
      bg-gray-50 border border-gray-100 rounded-xl p-4
      [&_h2]:text-lg [&_h2]:font-semibold [&_h2]:text-gray-900 [&_h2]:mt-4 [&_h2]:mb-2
      [&_h3]:text-base [&_h3]:font-semibold [&_h3]:text-gray-900 [&_h3]:mt-3 [&_h3]:mb-1
      [&_p]:mb-3 [&_p]:text-gray-700 [&_p]:leading-relaxed
      [&_strong]:text-gray-900 [&_strong]:font-semibold
      [&_ul]:list-disc [&_ul]:pl-5 [&_li]:mb-1
      [&_table]:border-collapse [&_td]:border [&_td]:border-gray-200 [&_td]:p-2 [&_td]:align-top
    "
  ></article>
</section>

    <!-- S·∫£n ph·∫©m li√™n quan -->
    <section id="related-products-section" class="mt-8 bg-white rounded-lg p-4 border border-gray-200" style="display:none;">
      <div class="flex items-center justify-between mb-4">
        <h2 class="font-semibold text-lg text-gray-900">üî• S·∫£n ph·∫©m c√πng danh m·ª•c</h2>
        <a id="related-category-link" href="#" class="text-sm text-blue-600 hover:text-blue-700">Xem t·∫•t c·∫£ ‚Üí</a>
      </div>
      <div id="related-products-grid" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>
    </section>
  </main>

  <!-- ==========================================
       BOTTOM ACTION BAR
       ========================================== -->
  <div class="shv-bottom-bar">
    <div class="actions">
      <button id="btn-chat-zalo" class="shv-btn-chat" aria-label="Chat Zalo">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
          <path d="M4.913 2.658c2.075-.27 4.19-.408 6.337-.408 2.147 0 4.262.139 6.337.408 1.922.25 3.291 1.861 3.405 3.727a4.403 4.403 0 00-1.032-.211 50.89 50.89 0 00-8.42 0c-2.358.196-4.04 2.19-4.04 4.434v4.286a4.47 4.47 0 002.433 3.984L7.28 21.53A.75.75 0 016 21v-4.03a48.527 48.527 0 01-1.087-.128C2.905 16.58 1.5 14.833 1.5 12.862V6.638c0-1.97 1.405-3.718 3.413-3.979z" />
        </svg>
        <span>Chat</span>
      </button>
      
      <button id="btn-add-cart" class="shv-btn-add">
        Th√™m v√†o gi·ªè
      </button>
      
      <button id="btn-buy-now" class="shv-btn-buy">
        MUA NGAY
      </button>
    </div>
  </div>

  <!-- Scripts -->
  <!-- Scripts -->
  <script>window.API_BASE="https://api.shophuyvan.vn";</script>
  
  <!-- ‚úÖ PRODUCT TOUR - H∆∞·ªõng d·∫´n ƒë·∫∑t h√†ng -->
  <script type="module">
  import { productTour } from './src/lib/product-tour.js';
  
  // L·∫Øng nghe s·ª± ki·ªán add to cart th√†nh c√¥ng
  document.addEventListener('cart-updated', () => {
    // N·∫øu ƒëang ·ªü step 1, chuy·ªÉn sang step 2
    if (productTour.currentStep === 'product-add-cart') {
      setTimeout(() => {
        productTour.next();
      }, 500);
    }
  });
  </script>
  
  <!-- ‚úÖ QUICK REGISTER - INTERCEPT ADD TO CART -->
  <script type="module">
  import { checkLoginBeforeAddCart } from './src/lib/quick-register.js';
  
  // ƒê·ª£i DOM load xong
  document.addEventListener('DOMContentLoaded', () => {
    const addCartBtn = document.getElementById('btn-add-cart');
    const buyNowBtn = document.getElementById('btn-buy-now');
    
    if (addCartBtn) {
      // L∆∞u handler g·ªëc n·∫øu c√≥
      const originalAddToCart = window.addToCart;
      
      // Override click handler
      addCartBtn.addEventListener('click', (e) => {
        // Ki·ªÉm tra login
        const isLoggedIn = checkLoginBeforeAddCart(() => {
          // Callback: ch·∫°y sau khi t·∫°o t√†i kho·∫£n ho·∫∑c b·ªè qua
          // Trigger l·∫°i event add to cart
          if (originalAddToCart && typeof originalAddToCart === 'function') {
            originalAddToCart();
          } else {
            // Fallback: dispatch custom event ƒë·ªÉ ui-pdp.js x·ª≠ l√Ω
            addCartBtn.dispatchEvent(new Event('click-after-login', { bubbles: true }));
          }
        });
        
        // N·∫øu ch∆∞a login, ngƒÉn event m·∫∑c ƒë·ªãnh
        if (!isLoggedIn) {
          e.stopPropagation();
          e.preventDefault();
          return false;
        }
      }, true); // Capture phase ƒë·ªÉ ch·∫°y tr∆∞·ªõc ui-pdp.js
    }
    
    // T∆∞∆°ng t·ª± cho "Mua ngay"
    if (buyNowBtn) {
      buyNowBtn.addEventListener('click', (e) => {
        const isLoggedIn = checkLoginBeforeAddCart(() => {
          // Sau khi login/register, trigger l·∫°i
          buyNowBtn.dispatchEvent(new Event('click-after-login', { bubbles: true }));
        });
        
        if (!isLoggedIn) {
          e.stopPropagation();
          e.preventDefault();
          return false;
        }
      }, true);
    }
  });
  </script>
  
  <script type="module" src="/src/ui-pdp.js?v=80"></script>
  <script type="module" src="/src/cart-badge-realtime.js?v=1"></script>
  
  <script>
    // ==========================================
    // HEADER BUTTON HANDLERS
    // ==========================================
    document.getElementById('btn-back').onclick = () => {
      try { history.back(); } catch { location.href = '/'; }
    };
    
    // Share menu toggle
    const shareBtn = document.getElementById('btn-share');
    const shareMenu = document.getElementById('share-menu');
    
    shareBtn.onclick = (e) => {
      e.stopPropagation();
      shareMenu.classList.toggle('show');
    };
    
    document.addEventListener('click', () => {
      shareMenu.classList.remove('show');
    });
    
    // Share handlers
    document.querySelectorAll('.shv-share-item').forEach(item => {
      item.onclick = () => {
        const type = item.dataset.type;
        const url = encodeURIComponent(location.href);
        const title = encodeURIComponent(document.title);
        
        if (type === 'zalo') {
          window.open(`https://zalo.me/share?url=${url}&title=${title}`, '_blank');
        } else if (type === 'facebook') {
          window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
        }
        
        shareMenu.classList.remove('show');
      };
    });
    
    // Chat Zalo
    document.getElementById('btn-chat-zalo').onclick = () => {
      window.open('https://zalo.me/0933190000', '_blank');
    };
  </script>
  <!-- <script src="https://admin.shophuyvan.vn/_shared/security.js"></script> -->
</body>
</html>