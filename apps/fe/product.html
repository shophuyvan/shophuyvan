<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PDP • Shop Huy Vân</title>
  <meta name="description" content="Shop Huy Vân - Điện gia dụng, đồ lắp đặt, phụ kiện thông minh." />
  <script src="https://cdn.tailwindcss.com"></script>
  
<!-- build:16 -->
  <script type="module" src="/src/pixels.js?v=44"></script>
  <script type="module" src="/src/cat-menu.js?v=44"></script>

<!-- SHV PDP HIDE HEADER CSS -->
<style id="shv-pdp-inline-css">
/* Hide global site header on PDP only */
body.pdp header, body.pdp .topbar, body.pdp .site-header, 
body.pdp .shv-header, body.pdp .navbar, body.pdp nav { display: none !important; }
  /* SHV patch: pre-line */
  .desc-preline{white-space:pre-line;}
  .faq-item{margin-bottom:8px}
</style>

  <!-- SEO-INJECTED -->
  <link id="canonical" rel="canonical" href="__BASE_URL__/product.html" />
  <meta property="og:type" content="product"/>
  <meta property="og:site_name" content="Shop Huy Vân"/>
  <script>
  // canonical from id, if present
  (function(){
    try {
      const u = new URL(window.location.href);
      const id = u.searchParams.get('id');
      const can = document.querySelector('link#canonical');
      if(id){ can.href = '__BASE_URL__/product/' + id; }
    } catch(e){}
  })();
  </script>
  <script id="pdp-jsonld" type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Product",
    "name": "Sản phẩm - Shop Huy Vân",
    "image": [],
    "description": "Sản phẩm tại Shop Huy Vân",
    "brand": {"@type": "Brand","name":"Shop Huy Vân"},
    "offers": {
      "@type": "AggregateOffer",
      "priceCurrency": "VND",
      "lowPrice": "0",
      "highPrice": "0",
      "availability": "https://schema.org/InStock"
    }
  }
  </script>
  <script>
  // Nếu client có thông tin sản phẩm toàn diện trong window.PRODUCT, cập nhật JSON-LD + OG
  (function(){
    try{
      const data = window.__SHV_PRODUCT__ || window.PRODUCT || null;
      if(!data) return;
      const j = document.getElementById('pdp-jsonld');
      const model = {
        "@context":"https://schema.org","@type":"Product",
        "name": data.name || data.title || "Sản phẩm",
        "image": (data.images||data.gallery||[]).map(x => typeof x==='string'? x : x.url).filter(Boolean),
        "description": data.description || data.desc || "",
        "sku": data.sku || data.id || "",
        "brand": {"@type":"Brand","name": (data.brand||'Shop Huy Vân')},
        "offers": {
          "@type": "Offer",
          "priceCurrency": "VND",
          "price": String(data.price||data.final_price||data.sale_price||data.original_price||0).replace(/\D/g,''),
          "availability": (data.stock>0?'https://schema.org/InStock':'https://schema.org/OutOfStock')
        }
      };
      j.textContent = JSON.stringify(model);
      // OG title/description
      const ogt = document.createElement('meta'); ogt.setAttribute('property','og:title'); ogt.content = (data.name||'Sản phẩm') + ' • Shop Huy Vân';
      const ogd = document.createElement('meta'); ogd.setAttribute('property','og:description'); ogd.content = (data.description||'Sản phẩm tại Shop Huy Vân');
      document.head.appendChild(ogt); document.head.appendChild(ogd);
    }catch(e){}
  })();
  </script>


  <script id="pdp-breadcrumb-jsonld" type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Trang chủ",
        "item": "__BASE_URL__/"
      }
    ]
  }
  </script>
  <script>
  // Build breadcrumb JSON-LD from product category/categoryPath
  (function(){
    try{
      var data = window.__SHV_PRODUCT__ || window.PRODUCT || null;
      if(!data) return;
      var cats = [];
      if (Array.isArray(data.categoryPath)) {
        cats = data.categoryPath.filter(Boolean);
      } else if (typeof data.categoryPath === 'string') {
        cats = data.categoryPath.split('/').map(s => s.trim()).filter(Boolean);
      } else if (Array.isArray(data.categories)) {
        cats = data.categories.filter(Boolean);
      } else if (typeof data.category === 'string') {
        cats = [data.category];
      }
      var items = [
        { "@type":"ListItem", "position":1, "name":"Trang chủ", "item": __BASE_URL__ + "/" }
      ];
      var pathAccum = "";
      cats.forEach(function(cat, i){
        // slugify
        var slug = String(cat).toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'').replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'');
        pathAccum += ("/c/" + slug);
        items.push({ "@type":"ListItem", "position": i+2, "name": cat, "item": __BASE_URL__ + pathAccum });
      });
      var prodName = (data.name || data.title || "Sản phẩm");
      var prodId = (data.id || "").toString().trim();
      var prodUrl = prodId ? (__BASE_URL__ + "/product/" + prodId) : (typeof location!=='undefined' ? location.href : (__BASE_URL__ + "/product.html"));
      items.push({ "@type":"ListItem", "position": items.length+1, "name": prodName, "item": prodUrl });

      var el = document.getElementById('pdp-breadcrumb-jsonld');
      var jsonld = { "@context":"https://schema.org", "@type":"BreadcrumbList", "itemListElement": items };
      el.textContent = JSON.stringify(jsonld);
    }catch(e){}
  })();
  </script>


  <!-- SEO-INJECTED: Dynamic Title & Description -->
  <script>
  (function(){
    try{
      var data = window.__SHV_PRODUCT__ || window.PRODUCT || null;
      if(!data) return;

      var name = (data.seo_title || data.name || data.title || "Sản phẩm").toString().trim();
      var price = (data.final_price || data.sale_price || data.price || data.original_price || "").toString().replace(/\D/g,'');
      var priceTxt = price ? (" | Giá " + new Intl.NumberFormat('vi-VN').format(Number(price)) + "₫") : "";
      document.title = name + " • Shop Huy Vân" + priceTxt;

      var desc = (
        data.seo_description ||
        data.meta_description ||
        data.short_description ||
        data.description ||
        data.desc || ""
      ).toString().replace(/\s+/g,' ').trim();
      if(desc.length > 160) desc = desc.slice(0,157) + '...';

      var md = document.querySelector('meta[name="description"]');
      if(!md){ md = document.createElement('meta'); md.setAttribute('name','description'); document.head.appendChild(md); }
      if(desc) md.setAttribute('content', desc);

      // Ensure OG title/desc/image align
      function setOG(prop, value){
        var m = document.querySelector('meta[property="'+prop+'"]');
        if(!m){ m=document.createElement('meta'); m.setAttribute('property', prop); document.head.appendChild(m); }
        if(value) m.setAttribute('content', value);
      }
      setOG('og:title', name + ' • Shop Huy Vân');
      setOG('og:description', desc);
      var img = (Array.isArray(data.images) && data.images[0]) || (Array.isArray(data.gallery) && data.gallery[0]) || data.image || '';
      if (img && typeof img === 'object' && img.url) img = img.url;
      if(img) setOG('og:image', img);
    }catch(e){}
  })();
  </script>
</head>
<body class="bg-slate-50 text-gray-900 pdp">
  <!-- SHV BREADCRUMB UI -->
  <style>
    .shv-breadcrumb{font-size:14px;color:#4b5563;display:flex;gap:6px;flex-wrap:wrap;align-items:center;margin:10px auto;max-width:1200px;padding:0 12px}
    .shv-breadcrumb a{color:#2563eb;text-decoration:none}
    .shv-breadcrumb a:hover{text-decoration:underline}
    .shv-breadcrumb .sep{opacity:.5}
    .shv-breadcrumb .last{color:#111827;font-weight:600}
    /* SHV patch: pre-line */
  .desc-preline{white-space:pre-line;}
  .faq-item{margin-bottom:8px}
</style>
  <nav class="shv-breadcrumb" aria-label="breadcrumb" id="shv-bc">
    <a href="__BASE_URL__/">Trang chủ</a>
    <span class="sep">›</span>
    <span class="last">Đang tải...</span>
  </nav>
  <script>
  // Render breadcrumb UI from product data
  (function(){
    try{
      var data = window.__SHV_PRODUCT__ || window.PRODUCT || null;
      var el = document.getElementById('shv-bc');
      if(!el) return;
      var items = [];
      function addLink(href, label){
        items.push('<a href="'+href+'">'+label+'</a>');
      }
      function addText(label){
        items.push('<span class="last">'+label+'</span>');
      }
      // categories
      var cats = [];
      if (data){
        if (Array.isArray(data.categoryPath)) cats = data.categoryPath.filter(Boolean);
        else if (typeof data.categoryPath==='string') cats = data.categoryPath.split('/').map(s=>s.trim()).filter(Boolean);
        else if (Array.isArray(data.categories)) cats = data.categories.filter(Boolean);
        else if (typeof data.category==='string') cats = [data.category];
      }
      // Start with home link already in HTML; rebuild full content:
      var html = [];
      html.push('<a href="__BASE_URL__/">Trang chủ</a>');
      var accum = '';
      function slugify(s){
        try{ return String(s).toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'').replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,''); }catch(e){ return String(s).toLowerCase().replace(/[^a-z0-9]+/g,'-'); }
      }
      cats.forEach(function(cat){
        html.push('<span class="sep">›</span>');
        accum += '/c/' + slugify(cat);
        html.push('<a href="'+ '__BASE_URL__' + accum +'">'+ cat +'</a>');
      });
      var name = (data && (data.name||data.title)) || 'Sản phẩm';
      html.push('<span class="sep">›</span>');
      html.push('<span class="last">'+ name +'</span>');
      el.innerHTML = html.join(' ');
    }catch(e){}
  })();
  </script>

  <header class="border-b bg-white">
    <div class="max-w-6xl mx-auto px-4 py-3 grid grid-cols-3 gap-4 items-center">
      <a href="/" class="font-semibold text-lg">SHOP HUY VÂN</a>
      <input id="search" class="border rounded px-3 py-2 w-full" placeholder="Tìm kiếm..."/>
      <a href="/cart" class="justify-self-end text-sm border rounded px-3 py-2">Giỏ</a>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6 grid md:grid-cols-12 gap-6">
    <section class="md:col-span-6 space-y-2">
      <div id="media-main" class="relative aspect-square bg-white rounded-lg overflow-hidden"></div>
      <div id="media-thumbs" class="grid grid-cols-6 gap-2"></div>
    </section>
    <section class="md:col-span-6 space-y-4">
      <h1 id="p-title" class="text-xl md:text-2xl font-semibold"></h1>
      <div class="flex items-center gap-3 text-sm text-gray-600">
        <span id="p-sold">0 đã bán</span><span>•</span><span id="p-rating">5★</span>
      </div>
      <div id="p-price" class="text-2xl font-semibold"></div>
      <div id="p-stock" class="text-sm text-gray-500"></div>
      <div id="p-variants" class="space-y-2"></div>
      <div class="flex items-center gap-3">
        <button id="btn-add" class="bg-rose-600 hover:bg-rose-700 text-white rounded px-4 py-2">Thêm giỏ</button>
        <a id="btn-zalo" target="_blank" rel="noopener" href="https://zalo.me/" class="border rounded px-4 py-2">Zalo</a>
      </div>
    </section>
    <section class="md:col-span-8">
      <h2 class="font-semibold mb-2">Mô tả</h2>
      <article id="p-desc" class="prose prose-sm max-w-none"></article>
    </section>
    <section class="md:col-span-4">
      <h2 class="font-semibold mb-2">Câu hỏi thường gặp (FAQ)</h2>
      <div id="p-faq" class="space-y-2"></div>
    </section>
    <section class="md:col-span-12">
      <h2 class="font-semibold mb-2">Đánh giá khách hàng</h2>
      <div id="p-reviews" class="space-y-3"></div>
    </section>
  </main>

  <script type="application/ld+json" id="id-product"></script>
  <script type="module" src="/src/ui-pdp.js?v=72"></script>



<!-- SHV: Render description & FAQ with markup (robust) -->
<script>
(function(){
  function normalizeNewlines(raw){
    if(raw==null) return '';
    // convert literal \n in saved text to real newline
    return String(raw).replace(/\\n/g, '\n');
  }
  function renderDesc(raw){
    raw = normalizeNewlines(raw);
    const lines = String(raw).split(/\n/);
    let html='', inList=false;
    for(const ln0 of lines){
      const ln = ln0.trimEnd();
      if(/^##\s+/.test(ln)){
        if(inList){ html+='</ul>'; inList=false; }
        html += '<h3 class="font-semibold mt-2 mb-1">'+ln.replace(/^##\s+/, '')+'</h3>';
      }else if(/^\-\s+/.test(ln)){
        if(!inList){ html+='<ul class="list-disc pl-5">'; inList=true; }
        html += '<li>'+ln.replace(/^\-\s+/, '')+'</li>';
      }else if(ln===''){
        if(inList){ html+='</ul>'; inList=false; }
        html += '<br/>';
      }else{
        html += '<p class="mb-1">'+ln+'</p>';
      }
    }
    if(inList) html+='</ul>';
    return html;
  }
  function parseFaq(raw){
    raw = normalizeNewlines(raw);
    const text = ' ' + raw.replace(/\s+/g,' ') + ' ';
    const out = [];
    const re = /\sHỏi\s*:\s*(.+?)\s*Đáp\s*:\s*(.+?)(?=\sHỏi\s*:|$)/gi;
    let m; while((m=re.exec(text))){ out.push({q:m[1].trim(), a:m[2].trim()}); }
    if(!out.length && raw.trim()){
      out.push({q: raw.trim(), a: ''});
    }
    return out;
  }
  function apply(){
    const p = (window.__PRODUCT__||{});
    const elDesc = document.querySelector('[data-bind="product-desc"]');
    const elFaq = document.querySelector('[data-bind="product-faq"]');
    if(elDesc) elDesc.innerHTML = renderDesc(p.desc||'');
    if(elFaq){
      const items = parseFaq(p.faq||'');
      elFaq.innerHTML = items.map(x=>('<details class="faq-item"><summary class="font-medium">'+x.q+'</summary><div class="mt-1">'+x.a+'</div></details>')).join('');
    }
  }
  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', apply); else apply();
})();
</script>


<!-- SHV PATCH: Fallback render mô tả & FAQ + weight_gram -->
<script>
(function(){
  // ======= Desc/FAQ renderer =======
  function norm(s){ return (s==null?'':String(s)); }
  function toHtml(raw){
    raw = norm(raw).replace(/\\n/g,'\n');
    const lines = raw.split(/\n/);
    let html='', list=false;
    for(const l0 of lines){
      const l = l0.trimEnd();
      if(/^##\s+/.test(l)){ if(list){html+='</ul>'; list=false;} html+='<h3 class="font-semibold mt-2 mb-1">'+l.replace(/^##\s+/,'')+'</h3>'; continue; }
      if(/^\-\s+/.test(l)){ if(!list){html+='<ul class="list-disc pl-5">'; list=true;} html+='<li>'+l.replace(/^\-\s+/,'')+'</li>'; continue; }
      if(l===''){ if(list){html+='</ul>'; list=false;} html+='<br/>'; continue; }
      html+='<p class="mb-1">'+l+'</p>';
    }
    if(list) html+='</ul>';
    return html;
  }
  function renderDescFaq(){
    var p = (window.__SHV_PRODUCT__ || window.PRODUCT || window.__PRODUCT__ || {});
    var descBox = document.getElementById('p-desc');
    var faqBox  = document.getElementById('p-faq');
    if(descBox){
      var raw = p.desc || p.description || descBox.textContent || '';
      descBox.innerHTML = toHtml(raw);
      descBox.classList.add('desc-preline');
    }
    if(faqBox){
      var rawFaq = p.faq || faqBox.textContent || '';
      rawFaq = norm(rawFaq).replace(/\\n/g,'\n');
      var text = (' '+rawFaq.replace(/\s+/g,' ')+' ');
      var re = /\sHỏi\s*:\s*(.+?)\s*Đáp\s*:\s*(.+?)(?=\sHỏi\s*:|$)/gi;
      var out = '', m; while((m=re.exec(text))){ out += '<details class="faq-item"><summary class="font-medium">'+m[1].trim()+'</summary><div class="mt-1">'+m[2].trim()+'</div></details>'; }
      if(out && faqBox) faqBox.innerHTML = out;
    }
  }

  // ======= weight_gram into cart =======
  function gramsOf(v){
    const raw = String(v??'').replace(',','.');
    const n = Number(raw);
    if(!n || isNaN(n)) return 0;
    return (/[.,]/.test(raw) && n>0 && n<=50) ? Math.round(n*1000) : Math.round(n);
  }
  function buildWeightMap(){
    const P = (window.__SHV_PRODUCT__ || window.PRODUCT || window.__PRODUCT__ || {});
    const map = { product: gramsOf(P.weight||P.weight_gram||0) };
    (P.variants||[]).forEach(v=>{ map['v:'+v.id] = gramsOf(v.weight||v.weight_gram||0); map['id:'+v.id]=map['v:'+v.id]; });
    return map;
  }
  function addWeightsToCart(cart){
    const map = buildWeightMap();
    (cart||[]).forEach(it=>{
      if(!it) return;
      if(!it.weight_gram || it.weight_gram<=0){
        const byVar = map['v:'+it.variant_id] || map['id:'+it.variant_id];
        const byId  = map['id:'+it.id] || map['v:'+it.id];
        it.weight_gram = byVar || byId || map.product || 0;
      }
    });
    return cart;
  }
  (function patchLocalStorage(){
    const orig = localStorage.setItem.bind(localStorage);
    localStorage.setItem = function(k,v){
      if(k==='cart'){
        try{ const arr = JSON.parse(v||'[]'); v = JSON.stringify(addWeightsToCart(arr)); }catch(e){}
      }
      return orig(k,v);
    };
    try{ const cur = localStorage.getItem('cart'); if(cur){ const arr = addWeightsToCart(JSON.parse(cur||'[]')); localStorage.setItem('cart', JSON.stringify(arr)); } }catch(e){}
  })();

  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', renderDescFaq);
  else renderDescFaq();
})();
</script>

</body>
</html>
