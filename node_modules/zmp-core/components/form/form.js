(function zmpComponentLoader(t,e){void 0===e&&(e=!0);var a=t.$,o=t.utils,r=(t.getDevice,t.getSupport,t.Class,t.Modal,t.ConstructorMethods,t.ModalMethods,o.checkLocalStorage),i=o.extend,n=o.serializeObject,f={store:function(t,e){var o=t,r=a(t);r.length&&r.is("form")&&r.attr("id")&&(o=r.attr("id")),this.form.data["form-"+o]=e,this.isLocalStorageAvailable&&(window.localStorage["zmpform-"+o]=JSON.stringify(e))},get:function(t){var e=t,o=a(t);return o.length&&o.is("form")&&o.attr("id")&&(e=o.attr("id")),this.isLocalStorageAvailable&&window.localStorage["zmpform-"+e]?JSON.parse(window.localStorage["zmpform-"+e]):this.form.data["form-"+e]?this.form.data["form-"+e]:void 0},remove:function(t){var e=this,o=t,r=a(t);r.length&&r.is("form")&&r.attr("id")&&(o=r.attr("id")),e.form.data["form-"+o]&&(e.form.data["form-"+o]="",delete e.form.data["form-"+o]),this.isLocalStorageAvailable&&window.localStorage["zmpform-"+o]&&(window.localStorage["zmpform-"+o]="",window.localStorage.removeItem("zmpform-"+o))}},s={init:function(t){var e=this,o=a(t),r=o.attr("id");if(r){var i=e.form.getFormData(r);i&&e.form.fillFromData(o,i),o.on("change submit",(function(){var t=e.form.convertToData(o);t&&(e.form.storeFormData(r,t),o.trigger("form:storedata",t),e.emit("formStoreData",o[0],t))}))}},destroy:function(t){a(t).off("change submit")}};function c(t){var e=a(t).eq(0);if(0!==e.length){var o={},r=["submit","image","button","file"],i=[];return e.find("input, select, textarea").each((function(t){var n=a(t);if(!n.hasClass("ignore-store-data")&&!n.hasClass("no-store-data")){var f=n.attr("name"),s=n.attr("type"),c=t.nodeName.toLowerCase();if(!(r.indexOf(s)>=0)&&!(i.indexOf(f)>=0)&&f)if("select"===c&&n.prop("multiple"))i.push(f),o[f]=[],e.find('select[name="'+f+'"] option').each((function(t){t.selected&&o[f].push(t.value)}));else switch(s){case"checkbox":i.push(f),o[f]=[],e.find('input[name="'+f+'"]').each((function(t){t.checked&&o[f].push(t.value)}));break;case"radio":i.push(f),e.find('input[name="'+f+'"]').each((function(t){t.checked&&(o[f]=t.value)}));break;default:o[f]=n.val()}}})),e.trigger("form:todata",o),this.emit("formToData",e[0],o),o}}function m(t,e){var o=a(t).eq(0);if(o.length){var r=e,i=o.attr("id");if(!r&&i&&(r=this.form.getFormData(i)),r){var n=["submit","image","button","file"],f=[];o.find("input, select, textarea").each((function(t){var e=a(t);if(!e.hasClass("ignore-store-data")&&!e.hasClass("no-store-data")){var i=e.attr("name"),s=e.attr("type"),c=t.nodeName.toLowerCase();if(void 0!==r[i]&&null!==r[i]&&!(n.indexOf(s)>=0)&&!(f.indexOf(i)>=0)&&i){if("select"===c&&e.prop("multiple"))f.push(i),o.find('select[name="'+i+'"] option').each((function(t){var e=t;r[i].indexOf(t.value)>=0?e.selected=!0:e.selected=!1}));else switch(s){case"checkbox":f.push(i),o.find('input[name="'+i+'"]').each((function(t){var e=t;r[i].indexOf(t.value)>=0?e.checked=!0:e.checked=!1}));break;case"radio":f.push(i),o.find('input[name="'+i+'"]').each((function(t){var e=t;r[i]===t.value?e.checked=!0:e.checked=!1}));break;default:e.val(r[i])}"select"!==c&&"input"!==c&&"textarea"!==c||e.trigger("change","fromdata")}}})),o.trigger("form:fromdata",r),this.emit("formFromData",o[0],r)}}}function d(){var t=this;a(document).on("submit change","form.form-ajax-submit, form.form-ajax-submit-onchange",(function(e,o){var r=a(this);if(("change"!==e.type||r.hasClass("form-ajax-submit-onchange"))&&("submit"===e.type&&e.preventDefault(),"change"!==e.type||"fromdata"!==o)){var i,f=(r.attr("method")||"GET").toUpperCase(),s=r.prop("enctype")||r.attr("enctype"),c=r.attr("action");if(c)i="POST"===f?"application/x-www-form-urlencoded"===s?t.form.convertToData(r[0]):new window.FormData(r[0]):n(t.form.convertToData(r[0])),t.request({method:f,url:c,contentType:s,data:i,beforeSend:function(e){r.trigger("formajax:beforesend",{data:i,xhr:e}),t.emit("formAjaxBeforeSend",r[0],i,e)},error:function(e){r.trigger("formajax:error",{data:i,xhr:e}),t.emit("formAjaxError",r[0],i,e)},complete:function(e){r.trigger("formajax:complete",{data:i,xhr:e}),t.emit("formAjaxComplete",r[0],i,e)},success:function(e,a,o){r.trigger("formajax:success",{data:i,xhr:o}),t.emit("formAjaxSuccess",r[0],i,o)}})}}))}var l={name:"form",isLocalStorageAvailable:!1,create:function(){this.isLocalStorageAvailable=r();var t=this;i(t,{form:{data:{},storeFormData:f.store.bind(t),getFormData:f.get.bind(t),removeFormData:f.remove.bind(t),convertToData:c.bind(t),fillFromData:m.bind(t),storage:{init:s.init.bind(t),destroy:s.destroy.bind(t)}}})},on:{init:function(){this.isLocalStorageAvailable=r();d.call(this)},tabBeforeRemove:function(t){var e=this;a(t).find(".form-store-data").each((function(t){e.form.storage.destroy(t)}))},tabMounted:function(t){var e=this;a(t).find(".form-store-data").each((function(t){e.form.storage.init(t)}))},pageBeforeRemove:function(t){var e=this;t.$el.find(".form-store-data").each((function(t){e.form.storage.destroy(t)}))},pageInit:function(t){var e=this;t.$el.find(".form-store-data").each((function(t){e.form.storage.init(t)}))}}};if(e){if(t.prototype.modules&&t.prototype.modules[l.name])return;t.use(l),t.instance&&(t.instance.useModuleParams(l,t.instance.params),t.instance.useModule(l))}return l}(ZMP, typeof ZMPAutoInstallComponent === 'undefined' ? undefined : ZMPAutoInstallComponent))
